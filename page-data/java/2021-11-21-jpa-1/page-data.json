{"componentChunkName":"component---src-templates-blog-template-js","path":"/java/2021-11-21-jpa-1/","result":{"data":{"cur":{"id":"511df62d-d746-5f90-a9e0-3bfff301bb03","html":"<br> \n<blockquote>\n<p>학습목적으로 작성되어 생략된 내용과 다소 부적확한 내용이 있을 수 있습니다.</p>\n</blockquote>\n<blockquote>\n<p>다루는 내용<br>\n@Entity, Jpa 연관관계, 편의메소드, @Embedded , @Embeddable</p>\n</blockquote>\n<h1 id=\"예제로-사용해볼-관계도\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%A0%9C%EB%A1%9C-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%BC-%EA%B4%80%EA%B3%84%EB%8F%84\" aria-label=\"예제로 사용해볼 관계도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예제로 사용해볼 관계도</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 484px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQY02WR227CMBBE8/+fVp5ouEQpxSEJNk7sQAAlzcWcyq5ArbrSaPzgPZrdjUR2wFpLURQIIajrGq01VVXhnGOeZ6ZpCno8HkgpKY9HjDFkQpDnOdYYlJQ0TUO03SYBmCQJy+USqVSAp2kaAE+gd18fe0EuNafa8L7Zskl3aGMRxZFPcSCK45jLpQ3NvnzzMI4opf4k7PuerutIdp/shWD0iSH0TfPMV99zrBuixeKNOF5xPl9eiTwoy7IwwvV6pW1b7vd7AKZ7wXq9IjvkDMMQ/nr5t6ws0e12C8k86CmfqCzLF/zpvk61xbmZcRh+VjFNuJCwozjVRH5f/gi/5cf1/u8ozqEqg6wM2jRhd94r21AqjbZnvgFvg8fE0YoTQAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/45d7a8f9fe560a3f64f0cfe9f99d5802/ff42b/jpa-1.png\"\n        srcset=\"/static/45d7a8f9fe560a3f64f0cfe9f99d5802/e9ff0/jpa-1.png 180w,\n/static/45d7a8f9fe560a3f64f0cfe9f99d5802/f21e7/jpa-1.png 360w,\n/static/45d7a8f9fe560a3f64f0cfe9f99d5802/ff42b/jpa-1.png 484w\"\n        sizes=\"(max-width: 484px) 100vw, 484px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">User(유저)</code>테이블 과 <code class=\"language-text\">Post(게시물)</code> 테이블이 있습니다.\n이때 <code class=\"language-text\">유저</code>는 여러개 의 <code class=\"language-text\">게시물</code>을 작성 할 수 있습니다.</p>\n<p>위의 테이블 구조로는 <code class=\"language-text\">유저</code>가 작성한 <code class=\"language-text\">게시물</code>이 어떤것 인지 알수 없습니다.<br>\n그래서 이때 relation id 를 둘중 하나의 테이블에 저장 해두어야 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 483px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVQY001R2W6EQAzj/3+s7fYJtRUSy3IsxzBTyn2I05UjsSKSlZA4jjVYKs+Ra41xHJGkKfI8l7osSxRFgeM4sK6rYN93mflhJPmvKBBGEdq2xTAMSJIEVhiGuN89afq+jyAIRIxDgkEhgkEh27aFk2UZXNeF1ka+HceBlSYxbp83ZEq9XDDzotZaHLI+wd7H+xuecYxpmmS+LIvsicNfYxDHT7lCwhkk0XHXdS+xeZ7F4c/3Fx6+j34YhEtRhlIKFt/MGIO+71FVlaCua+lxRvK2beKANY8+PE+WaYJc7jRNIwas8wdwcAVJXKbYFXwOzumcIqyv+R9iWMgX1Q6oSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/4f2dbd2baaf4c72ad0fffed50b3723c7/77a9e/jpa-2.png\"\n        srcset=\"/static/4f2dbd2baaf4c72ad0fffed50b3723c7/e9ff0/jpa-2.png 180w,\n/static/4f2dbd2baaf4c72ad0fffed50b3723c7/f21e7/jpa-2.png 360w,\n/static/4f2dbd2baaf4c72ad0fffed50b3723c7/77a9e/jpa-2.png 483w\"\n        sizes=\"(max-width: 483px) 100vw, 483px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>한명의 <code class=\"language-text\">User</code> 가 여러개의 <code class=\"language-text\">Post</code> 를 가질 수 있으므로, <code class=\"language-text\">Post</code> 테이블에 관계 ID를 저장하도록 변경합니다.\n<code class=\"language-text\">Post</code> 테이블에 <code class=\"language-text\">user_id</code> 컬럼은 <code class=\"language-text\">User</code> 테이블의 고유 <code class=\"language-text\">id</code>입니다.</p>\n<h2 id=\"데이터\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0\" aria-label=\"데이터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터</h2>\n<ul>\n<li>User 테이블</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>name</th>\n<th>password</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>name1</td>\n<td>pass1</td>\n</tr>\n<tr>\n<td>2</td>\n<td>name2</td>\n<td>pass2</td>\n</tr>\n<tr>\n<td>3</td>\n<td>name3</td>\n<td>pass3</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>Post 테이블</li>\n</ul>\n<p>|id|user_id|title|contents|\n|------|---|---|\n|1|3|제목 123|내용|\n|1|3|제목 748|내용|\n|2|1|제목 189|내용|\n|3|2|제목 1894|내용|\n|3|2|제목 181|내용|</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">\n<span class=\"token comment\"># user.id 가 \"1\" 인 post 찾기 쿼리  </span>\n<span class=\"token keyword\">select</span> post <span class=\"token keyword\">from</span> post <span class=\"token keyword\">where</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># post 테이블에서 \"post.user_id = 1\" 조건으로 user 데이터 가져오기</span>\n<span class=\"token keyword\">select</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">from</span> post <span class=\"token keyword\">join</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">on</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">=</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">.</span>id <span class=\"token keyword\">where</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># user 테이블에서 \"user.id = 1\" 조건으로 post 데이터 가져오기</span>\n<span class=\"token keyword\">select</span> post <span class=\"token keyword\">from</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">join</span> post <span class=\"token keyword\">on</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token keyword\">where</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> \n</code></pre></div>\n<p>DB 에서는 한쪽 테이블에서 Relation Id(관계 ID)를 가지고 있어도 양방향 조회가 가능합니다.</p>\n<h2 id=\"객체-관점에서-보기\" style=\"position:relative;\"><a href=\"#%EA%B0%9D%EC%B2%B4-%EA%B4%80%EC%A0%90%EC%97%90%EC%84%9C-%EB%B3%B4%EA%B8%B0\" aria-label=\"객체 관점에서 보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>객체 관점에서 보기</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> unique <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Lob</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"contents\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> contents<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> foreignKey <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ForeignKey</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fk_post_user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> contents<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> title<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contents <span class=\"token operator\">=</span> contents<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>앞서 DB 에서는 어느 한쪽에 연관 ID 를 가지고있으면 양방향으로 조회가되는것을 확인했었습니다.<br>\n하지만 객체입장에서는 양방향이라는 것이 존재하지 않습니다.  단방향만 존재 할 뿐입니다.\n여기서 단방향 관계란, 한쪽의 Entity 에서만 참조 되고있는 것을 말합니다.<br>\n양방향 관계란, 양쪽 Entity 서로 참조 되고 있는 것을 말합니다.</p>\n<p>위의 Entity 코드는 <code class=\"language-text\">User</code> -> <code class=\"language-text\">Post</code> , <code class=\"language-text\">Post</code> -> <code class=\"language-text\">User</code> 어느 Entity 에서든 서로 접근이 가능하기 때문에 양방향 참조 중입니다.</p>\n<p>연관 관계 코드는 아래 두 부분입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token operator\">*</span><span class=\"token operator\">*</span> <span class=\"token class-name\">User</span> entity\n<span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">*</span><span class=\"token operator\">*</span> <span class=\"token class-name\">Post</span> entity\n<span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span> \n<span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> foreignKey <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ForeignKey</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fk_post_user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n<li><code class=\"language-text\">mappedBy</code> 옵션은 주인 테이블을 지정해주는 역할합니다. Post entity 에서 설정 되어있는 <code class=\"language-text\">user</code>를 지정합니다.</li>\n<li><code class=\"language-text\">@JoinColumn</code> 으로 연관 관계 컬럼을 지정합니다. 연관 관계 컬럼은 <code class=\"language-text\">user_id</code>으로 설정합니다.</li>\n</ul>\n<p>만약 <code class=\"language-text\">User entity</code> 에서 <code class=\"language-text\">@OneToMany</code>를 제거 한다면, <code class=\"language-text\">Post</code>-><code class=\"language-text\">User</code>의 단방향 관계로만 맵핑됩니다.<br>\n보통은 처음에는 모두 단방향 관계로 설계했다가 프로젝트가 진행하면서 양방향으로 뚫어야 할때 그때 양방향으로 하는것을 지향한다고 합니다.</p>\n<blockquote>\n<p><a href=\"https://www.youtube.com/playlist?list=PL9mhQYIlKEhfpMVndI23RwWTL9-VL-B7U\">토크ON 41차. JPA 프로그래밍 기본기 다지기 T아카데미</a><br>\n영상을 통해 자세한 기본 개념을 익히는데 도움이 됩니다.</p>\n</blockquote>\n<h2 id=\"ddl-문-확인하기\" style=\"position:relative;\"><a href=\"#ddl-%EB%AC%B8-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"ddl 문 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DDL 문 확인하기</h2>\n<p>sql 출력 로그를 확인하기 위해 Spring 프로젝트의 <code class=\"language-text\">application.properties</code> 파일에 아래같이 설정합니다.<br>\nH2 테스트 디비와 , sql 출력 설정입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">spring.datasource.url=jdbc:h2:~/test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE\nspring.datasource.username=sa\nspring.h2.console.enabled=true\n\nspring.jpa.properties.hibernate.format_sql=true\nspring.jpa.show-sql=true\nlogging.level.org.hibernate.type.descriptor.sql=trace</code></pre></div>\n<p>위 코드를 실행하고, DDL 문 출력 결과입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> post <span class=\"token punctuation\">(</span>\n  id <span class=\"token keyword\">bigint</span> generated <span class=\"token keyword\">by</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">identity</span><span class=\"token punctuation\">,</span>\n  contents clob<span class=\"token punctuation\">,</span>\n  title <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  user_id <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">user</span> <span class=\"token punctuation\">(</span>\n  id <span class=\"token keyword\">bigint</span> generated <span class=\"token keyword\">by</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">identity</span><span class=\"token punctuation\">,</span>\n  name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  password <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 유니크 설정 SQL 입니다.</span>\n<span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">user</span> \n  <span class=\"token keyword\">add</span> <span class=\"token keyword\">constraint</span> UK_gj2fy3dcix7ph7k8684gka40c <span class=\"token keyword\">unique</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># foregin key 설정입니다. </span>\n<span class=\"token comment\"># `@JoinColumn(name = \"user_id\", foreignKey = @ForeignKey(name = \"fk_post_user\"))` 설정 으로 발생하는 쿼리 입니다.</span>\n<span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> post \n  <span class=\"token keyword\">add</span> <span class=\"token keyword\">constraint</span> fk_post_user \n  <span class=\"token keyword\">foreign</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">)</span> \n  <span class=\"token keyword\">references</span> <span class=\"token keyword\">user</span></code></pre></div>\n<blockquote>\n<p>JPA 굳… 어노테이션 맵핑했을 뿐인데 DB 에 해당 부분에 맞추어 만들어줍니다!</p>\n</blockquote>\n<h3 id=\"entity-test-코드로-하나씩-짚어보기\" style=\"position:relative;\"><a href=\"#entity-test-%EC%BD%94%EB%93%9C%EB%A1%9C-%ED%95%98%EB%82%98%EC%94%A9-%EC%A7%9A%EC%96%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"entity test 코드로 하나씩 짚어보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entity Test 코드로 하나씩 짚어보기</h3>\n<h4 id=\"1-양방향-맵핑시-무한루프-문제\" style=\"position:relative;\"><a href=\"#1-%EC%96%91%EB%B0%A9%ED%96%A5-%EB%A7%B5%ED%95%91%EC%8B%9C-%EB%AC%B4%ED%95%9C%EB%A3%A8%ED%94%84-%EB%AC%B8%EC%A0%9C\" aria-label=\"1 양방향 맵핑시 무한루프 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 양방향 맵핑시 무한루프 문제</h4>\n<p>양방향 맵핑시 무한루프가 문제가 발생 할 수 있습니다.<br>\n코드 부터 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">user_to_save_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1. new User</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. new Post</span>\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"제목\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"내용입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      \n    <span class=\"token comment\">// 3. user.addPost()</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 4. post.getUser()</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span><span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 무한 루프 발생 </span>\n<span class=\"token punctuation\">}</span>\n\n\n# 콘솔 로그 \n<span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>StackOverflowError</span>\n\tat <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>jpaexamples<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span>User</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">59</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">2951</span><span class=\"token punctuation\">)</span>\n\tat <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>jpaexamples<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span>Post</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">2951</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>StringBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">168</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span>AbstractCollection</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AbstractCollection</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">473</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">2951</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">post.getUser()</code> 를 출력하려는데 <code class=\"language-text\">StackOverflowError</code>에러가 발생합니다.<br>\n이유는 post -> user -> post -> user 계속해서 참조 객체를 찾으려 해서 문제가 발생 한것으로 보여집니다.<br>\n이때에는 <code class=\"language-text\">toString()</code> 메소드를 수정해주어야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n# <span class=\"token class-name\">User</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User{\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", password='\"</span> <span class=\"token operator\">+</span> password <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", posts='\"</span> <span class=\"token operator\">+</span> posts <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>  <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">></span> 제거\n            <span class=\"token char\">'}'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n# <span class=\"token constant\">POST</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Post{\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", title='\"</span> <span class=\"token operator\">+</span> title <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", contents='\"</span> <span class=\"token operator\">+</span> contents <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", user='\"</span> <span class=\"token operator\">+</span> user <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>   <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">></span> 제거\n            <span class=\"token char\">'}'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"2-편의메소드\" style=\"position:relative;\"><a href=\"#2-%ED%8E%B8%EC%9D%98%EB%A9%94%EC%86%8C%EB%93%9C\" aria-label=\"2 편의메소드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 편의메소드</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> 편의메소드_예제<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1. new User</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. new Post</span>\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"제목\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"내용입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. user.getPosts();</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getPosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span> 결과 <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Post</code> 생성자를 통해 <code class=\"language-text\">user</code>참조 객체를 전달해주었습니다. <code class=\"language-text\">user.getPosts()</code> 출력은 [] 비어 있습니다.<br>\n당연…하지만 편의메소드를 알아보기위한 예제입니다. ㅎ<br>\n보시는것과 같이 객체는 단방향개념 밖에 없습니다. 그래서 객체입장에서는 양방향 관계라기 보다는 양방향 관계인것 처럼 만들어 주어야 합니다.</p>\n<ul>\n<li>편의 메소드 리팩토링</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">toUser</code> 메소드에 <code class=\"language-text\">user.addPost(this);</code> <code class=\"language-text\">user</code> 객체에도 자신(<code class=\"language-text\">post</code>)을 추가해주는 코드를 추가해줍니다. 이제 <code class=\"language-text\">post.toUser(user)</code> 메소드를 호출 하게 되면 <code class=\"language-text\">post</code> 객체에도 추가되고 <code class=\"language-text\">user</code> 객체에도 추가하도록 해주는게 <code class=\"language-text\">편의메소드</code>입니다.</p>\n<p>수정 후 테스트 코드를 다시 실행 해보면 <code class=\"language-text\">user</code> 객체에도 추가된것을 확인 할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">// <span class=\"token number\">3</span>. user.getPosts<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSystem.out.println<span class=\"token punctuation\">(</span>user.getPosts<span class=\"token punctuation\">(</span><span class=\"token punctuation\">))</span><span class=\"token punctuation\">;</span> // <span class=\"token punctuation\">[</span>Post<span class=\"token punctuation\">{</span>id<span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">title</span><span class=\"token operator\">=</span><span class=\"token string\">'제목'</span>, <span class=\"token assign-left variable\">contents</span><span class=\"token operator\">=</span><span class=\"token string\">'내용입니다.'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h3 id=\"jparepository-test\" style=\"position:relative;\"><a href=\"#jparepository-test\" aria-label=\"jparepository test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JpaRepository Test</h3>\n<p>이제는 JpaRepository 테스트를 통해 데이터를 insert, select 테스트를 해보며 학습해보겠습니다.\n간단하게 짚고만 넘어가겠습니다. <code class=\"language-text\">JpaRepository</code> 는 Entity 클래스를 CRUD 뿐만 <code class=\"language-text\">Query Methods</code>를\n사용하여 DB 쿼리를 만들어주어 추가,업데이트,삭제를 손쉽게 사용 할 수 있는 인터페이스입니다.\n(다음에 자세하게 다루어 보겠습니다..)</p>\n<p><a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#preface\">Spring Data JPA 문서</a></p>\n<h4 id=\"entity-레포지토리-만들기\" style=\"position:relative;\"><a href=\"#entity-%EB%A0%88%ED%8F%AC%EC%A7%80%ED%86%A0%EB%A6%AC-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"entity 레포지토리 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entity 레포지토리 만들기</h4>\n<p>보통은 <code class=\"language-text\">{Entity Name}Repository</code> 의 형태로 이름을 정하고,<br>\n<code class=\"language-text\">public interface {Entity Name}Repository extends JpaRepository&lt;T, ID></code> 의 형태로 레포지토리를 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">#  <span class=\"token class-name\">UserRepository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n# <span class=\"token class-name\">PostRepository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PostRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByTitle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"jpa-테스트-하기\" style=\"position:relative;\"><a href=\"#jpa-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%98%EA%B8%B0\" aria-label=\"jpa 테스트 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPA 테스트 하기</h4>\n<p><code class=\"language-text\">@DataJpaTest</code> 를 사용하면 손쉽게 테스트를 진행 할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@DataJpaTest</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RepositoryTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">PostRepository</span> postRepository<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>User 생성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">user_save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (1) 비영속</span>\n    userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (2) 영속</span>\n<span class=\"token punctuation\">}</span>\n\n# 출력 <span class=\"token constant\">SQL</span>\n<span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n        \nbinding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>name1<span class=\"token punctuation\">]</span>\nbinding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PASSWORD</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>(1) 은 비영속 상태로 <code class=\"language-text\">entityManage</code> 에게 매니징 되고 있는 아닌 상태입니다. (2) 에서 <code class=\"language-text\">save(entity)</code> 를 호출하게 되면\nDB에 <code class=\"language-text\">flush</code> 하게 되어 DB insert 가 보내지게 됩니다.<br>\n여기서 말하는 <code class=\"language-text\">영속</code>, <code class=\"language-text\">비영속</code>은 엔티티 생명주기라고 하는데요.<br>\n엔티티 생명주기에는</p>\n<ol>\n<li>비영속(new/transient): 영속성 컨텍스트와 전혀 관계가 없는 상태</li>\n<li>영속(managed): 영속성 컨텍스트에 저장된 상태</li>\n<li>준영속(detached): 영속성 컨텍스트에 저장되었다가 분리된 상태</li>\n<li>삭제(removed): 삭제된 상태</li>\n</ol>\n<p>그럼 영속성 컨텍스트는 뭘까요… ㅜㅜ?<br>\n우선은 업데이트 테스트 부터 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">@Test\nvoid <span class=\"token function-name function\">user_update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    User user <span class=\"token operator\">=</span> new User<span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span>, <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    System.out.println<span class=\"token punctuation\">(</span><span class=\"token string\">\"log (1)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    User savedUser <span class=\"token operator\">=</span> userRepository.save<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    System.out.println<span class=\"token punctuation\">(</span><span class=\"token string\">\"log (2)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    savedUser.setName<span class=\"token punctuation\">(</span><span class=\"token string\">\"이름 변경\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    System.out.println<span class=\"token punctuation\">(</span><span class=\"token string\">\"log (3)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userRepository.flush<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># log </span>\nlog <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nHibernate: \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id, name, password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span>null, ?, ?<span class=\"token punctuation\">)</span>\nlog <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\nlog <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\nHibernate: \n    update\n        user \n    <span class=\"token builtin class-name\">set</span>\n        <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>?,\n        <span class=\"token assign-left variable\">password</span><span class=\"token operator\">=</span>? \n    where\n        <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>?</code></pre></div>\n<p>log 찍힌걸 보면,<br>\n<code class=\"language-text\">User savedUser = userRepository.save(user);</code> 으로 통해 <code class=\"language-text\">insert query</code> 가 commit 됩니다.<br>\n이때 <code class=\"language-text\">savedUser</code> 는 영속성을 가지는 객체입니다.<br>\n<code class=\"language-text\">savedUser.setName(\"이름 변경\")</code> 반응없고,<br>\n<code class=\"language-text\">userRepository.flush()</code> 에서 업데이트 쿼리가 commit 됩니다.<br>\n<code class=\"language-text\">savedUser</code>는 엔티티매니져(영속컨텍스트)에 의해 관리 되고 있는 상태입니다.<br>\n그래서 커밋 시점에 변경된 부분이 있으면 해당 부분을 DB 에 반영시키는 쿼리를 보냅니다.</p>\n<p>더 자세한 설명은…<br>\n<img src=\"../../assets/images/%EC%98%A4%EB%8A%98%EC%9D%80%EC%97%AC%EA%B8%B0%EA%B9%8C%EC%A7%80.png\" alt=\"img.png\"><br>\n자세한 설명은 잘 정리된 블로그 링크로 대체하겠습니다. <a href=\"https://siyoon210.tistory.com/138\">링크</a></p>\n<h5 id=\"post-save\" style=\"position:relative;\"><a href=\"#post-save\" aria-label=\"post save permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Post save</h5>\n<p>Post 를 저장 해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트를 실행하면 <code class=\"language-text\">org.hibernate.TransientPropertyValueException: Not-null property references a transient value ....</code> 에러가 발생합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> foreignKey <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ForeignKey</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fk_post_user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">@JoinColumn</code> 설정에서 <code class=\"language-text\">nullable = false</code> 옵션을 줬기 때문입니다. 그렇기 때문에 <code class=\"language-text\">Post</code> 저장시 <code class=\"language-text\">User</code> 는 영속(저장된) 상태여야합니다.</p>\n<p>수정된 코드로 실행하면</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// User save</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    \n    # 로그\n    \n<span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>name1<span class=\"token punctuation\">]</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PASSWORD</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">]</span>\n<span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        post\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> contents<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> user_id<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">CLOB</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>content<span class=\"token punctuation\">]</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>title<span class=\"token punctuation\">]</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">BIGINT</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><code class=\"language-text\">user_id</code> 가 [1] 로 들어가지고 있는것을 확인 할 수 있습니다.</p>\n<p><strong>이번에는</strong> <code class=\"language-text\">User</code> 를 통해서 <code class=\"language-text\">Post</code>를 저장해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_user_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// User save</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    # 로그\n    <span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>하지만, <code class=\"language-text\">Post</code>는 저장되지 않습니다. 이유는 연관관계 주인이 아닌곳에서는(<code class=\"language-text\">mappedBy</code>) 읽기만 가능하기 때문입니다.\n이때 두가지 방법이 있습니다.<br>\n<code class=\"language-text\">편의메소드</code>, <code class=\"language-text\">cascade 옵션</code></p>\n<p><strong>1. 편의 메소드</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  # <span class=\"token class-name\">User</span> \n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span> post<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n    \n  # 테스트 코드 \n  user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">user.addPoat(post)</code> 호출시 내부에서 <code class=\"language-text\">post</code>에게도 양방향으로 적용해주는 방법입니다. 그리고 <code class=\"language-text\">post</code>를 save() 해주어야합니다.</p>\n<p><strong>2. Cascade 옵션</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSIST</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">cascade = CascadeType.PERSIST</code> 옵션을 추가해주는 방법입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_user_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// User save</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    # 로그\n    <span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n        \n    <span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        post\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> contents<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> user_id<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">userRepository.save(user);</code> 할때, <code class=\"language-text\">id</code>가 NULL 이면 같이 저장을 수행합니다.</p>\n<blockquote>\n<ul>\n<li>CascadeType 의 종류</li>\n</ul>\n</blockquote>\n<ul>\n<li>CascadeType.RESIST – 엔티티를 생성하고, 연관 엔티티를 추가하였을 때 persist() 를 수행하면 연관 엔티티도 함께 persist()가 수행된다.</li>\n</ul>\n<p>만약 연관 엔티티가 DB에 등록된 키값을 가지고 있다면 detached entity passed to persist Exception이 발생합니다.</p>\n<ul>\n<li>CascadeType.MERGE – 트랜잭션이 종료되고 detach 상태에서 연관 엔티티를 추가하거나 변경된 이후에 부모 엔티티가 merge()를 수행하게 되면</li>\n</ul>\n<p>변경사항이 적용됨(연관 엔티티의 추가 및 수정 모두 반영됨)</p>\n<ul>\n<li>CascadeType.REMOVE – 삭제 시 연관된 엔티티도 같이 삭제됨</li>\n<li>CascadeType.DETACH – 부모 엔티티가 detach()를 수행하게 되면, 연관된 엔티티도 detach() 상태가 되어 변경사항이 반영되지 않음.</li>\n<li>CascadeType.ALL – 모든 Cascade 적용</li>\n</ul>\n<h4 id=\"embedded--embeddable\" style=\"position:relative;\"><a href=\"#embedded--embeddable\" aria-label=\"embedded  embeddable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Embedded , @Embeddable</h4>\n<p>좀더 객체지향적 개발을 위해 데이터를 상태와 행위를 가지는 객체로 추상화 시켜보겠습니다.<br>\n이때에 <code class=\"language-text\">@Embedded , @Embeddable</code>를 활용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Embeddable</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Posts</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSIST</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span> post<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> writer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span>writer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n      \n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Posts</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span> post<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">List&lt;Post> posts</code> 일급컬렉션으로 <code class=\"language-text\">Posts</code>로 분리하였고 <code class=\"language-text\">@Embeddable</code>어노테이션을 붙였습니다.<br>\n그리고,  사용되는 <code class=\"language-text\">Entity</code> 에서는  <code class=\"language-text\">@Embedded</code> 으로 활용하여 하나의 <code class=\"language-text\">Entity</code>인것 처럼 사용할 수 있습니다.</p>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>다루어야 될 많은 내용이 아직 많지만, 내용이 너무 길어지는것 같아 여기서 마무리 하겠습니다.\n추후 내용 보완 및 추가해보겠습니다.\n감사합니다.</p>","excerpt":"학습목적으로 작성되어 생략된 내용과 다소 부적확한 내용이 있을 수 있습니다. 다루는 내용 @Entity, Jpa 연관관계, 편의메소드, @Embedded , @Embeddable 예제로 사용해볼 관계도  테이블 과  테이블이 있습니다.\n이때 는 여러개 의 을 작성 할 수 있습니다. 위의 테이블 구조로는 가 작성한 이 어떤것 인지 알수 없습니다. 그래서 이때 relation id 를 둘중 하나의 테이블에 저장 해두어야 합니다.  한명의  가 여러개의  를 가질 수 있으므로,  테이블에 관계 ID를 저장하도록 변경합니다.\n 테이블에  컬럼은  테이블의 고유 입니다. 데이터 User 테이블 id name password 1 name1 pass1 2 name2 pass2 3 name3 pass3 Post 테이블 |id|user_id|title|contents|\n|------|---|---|\n|1|3|제목 123|내용|\n|1|3|제목 748|내용|\n|2|1|제목 189|내용|\n|3|2|제목…","frontmatter":{"date":"November 21, 2021","title":"JPA - 학습하기","categories":"프로그래밍","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/java/2021-11-21-jpa-1/"}},"next":{"id":"6be84c19-2a95-56e8-b479-b8ca78a90115","html":"<br>\n<blockquote>\n<p>참조블로그 : <a href=\"https://asfirstalways.tistory.com/350\">https://asfirstalways.tistory.com/350</a></p>\n</blockquote>\n<h1 id=\"빌더-패턴\" style=\"position:relative;\"><a href=\"#%EB%B9%8C%EB%8D%94-%ED%8C%A8%ED%84%B4\" aria-label=\"빌더 패턴 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빌더 패턴</h1>\n<p>한번에 인스턴스를 생성하고 싶은데 생성자 인자가 너무 많을때 혹은 기본 생성자로 인스턴스를 만들고 setter 로 점진적으로 값을 주입시킬때 이럴때 빌더 패턴을 사용하면 장점이 있습니다.</p>\n<h2 id=\"빌더-패턴을-사용하지-않은-예\" style=\"position:relative;\"><a href=\"#%EB%B9%8C%EB%8D%94-%ED%8C%A8%ED%84%B4%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EC%A7%80-%EC%95%8A%EC%9D%80-%EC%98%88\" aria-label=\"빌더 패턴을 사용하지 않은 예 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빌더 패턴을 사용하지 않은 예</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> address<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> zipCode<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> age<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> address<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> zipCode<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phoneNumber <span class=\"token operator\">=</span> phoneNumber<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>address <span class=\"token operator\">=</span> address<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>zipCode <span class=\"token operator\">=</span> zipCode<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> email<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<ul>\n<li>생성자</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이름\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"010-1234-5678\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"집주소\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"email@email.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n </code></pre></div>\n<p>생성 인자가 너무 많다보니, 순차적으로 뭐가 들어가는지도 헷갈리기 시작합니다. 혹여나 실수로 위치를 다르게 넣을 수 도 있을것 같습니다.</p>\n<h2 id=\"빌더-패턴-적용-예\" style=\"position:relative;\"><a href=\"#%EB%B9%8C%EB%8D%94-%ED%8C%A8%ED%84%B4-%EC%A0%81%EC%9A%A9-%EC%98%88\" aria-label=\"빌더 패턴 적용 예 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>빌더 패턴 적용 예</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> address<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> zipCode<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> address<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> zipCode<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phoneNumber <span class=\"token operator\">=</span> phoneNumber<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>address <span class=\"token operator\">=</span> address<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>zipCode <span class=\"token operator\">=</span> zipCode<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> email<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Builder</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> age<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> address<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> zipCode<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Builder</span> <span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Builder</span> <span class=\"token function\">age</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>age <span class=\"token operator\">=</span> age<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Builder</span> <span class=\"token function\">contact</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> phoneNumber<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>phoneNumber <span class=\"token operator\">=</span> phoneNumber<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> email<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Builder</span> <span class=\"token function\">house</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> address<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> zipCode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>address <span class=\"token operator\">=</span> address<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>zipCode <span class=\"token operator\">=</span> zipCode<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> phoneNumber<span class=\"token punctuation\">,</span> address<span class=\"token punctuation\">,</span> zipCode<span class=\"token punctuation\">,</span> age<span class=\"token punctuation\">,</span> email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>빌더 패턴을 사용하면 많은 생성자 인자를 명시적으로 맵핑 할 수 있는 장점이 있고, 기본 생성자를 만들고 <code class=\"language-text\">setter</code>로 순차적으로 맵핑하는 것보다\n한번에 인스턴스를 생성 할 수있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">User<span class=\"token punctuation\">.</span>Builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"이름\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">age</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">contact</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"010-1234\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"email@email.com\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">house</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"집주소\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">12345</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>한번에 그리고 명시적으로 파라미터를 맵핑 할 수 있는 장점이 있는 빌더 패턴을 알아보았습니다.</p>","frontmatter":{"date":"November 12, 2021","title":"빌더 패턴","categories":"프로그래밍","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/java/2021-11-12-builder-pattern/"}},"prev":{"id":"59ba0202-6d2c-5ed3-a013-eb05901a6266","html":"<h1 id=\"tdd-란\" style=\"position:relative;\"><a href=\"#tdd-%EB%9E%80\" aria-label=\"tdd 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD 란?</h1>\n<p>TDD 란 Test Driven Development 의 약자로 “테스트 주도 개발”이라고 합니다.</p>\n<h2 id=\"tdd-의-장점\" style=\"position:relative;\"><a href=\"#tdd-%EC%9D%98-%EC%9E%A5%EC%A0%90\" aria-label=\"tdd 의 장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD 의 장점</h2>\n<p><a href=\"https://www.simform.com/blog/what-is-tdd/#benefits\">출처</a></p>\n<ol>\n<li>코드 품질\n<ol>\n<li>TDD 는 개발자가 단순한 설계를 할 수 있도록 도와줍니다. 일반적으로 OOP 구조를 유지할 수 있습니다.</li>\n</ol>\n</li>\n<li>애플리케이션 품질\n<ol>\n<li>TDD 는 프로덕션 코드를 구현하기 전에 먼저 테스트를 해보고 프로덕션 코드를 구현 할 수 있습니다. TDD 를 통해 프로덕션 코드를 점진적으로 개발해 나가므로써, 철저한 테스트와 적은 버그를 발생 시킬 수 있습니다.</li>\n</ol>\n</li>\n<li>생산성 향상\n<ol>\n<li>디버깅 시간을 줄일 수 있습니다. TDD 로 개발을 시작하면 초기에는 시간이 많이 소요 될 수 있습니다. 하지만, 새로운 기능 추가 및 테스트 시간이 더 빨라지고 든든한 테스트가 있기때문에 리팩토링에 부담을 줄일 수 있습니다.</li>\n</ol>\n</li>\n<li>문서\n<ol>\n<li>테스트 코드는 문서 역할을 할 수 있습니다. 잘 정리된 테스트코드 가 있다면, 테스트 코드로 프로젝트를 이해 할 수 있습니다. 뿐만 아니라 모든 코드를 이해 하고 있지 않더라도 모든 개발자가 코드를 변경 할 수 있습니다.</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"tdd-의-한계\" style=\"position:relative;\"><a href=\"#tdd-%EC%9D%98-%ED%95%9C%EA%B3%84\" aria-label=\"tdd 의 한계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD 의 한계</h2>\n<p><a href=\"https://www.simform.com/blog/what-is-tdd/#benefits\">출처</a></p>\n<blockquote>\n<p>프로젝트의 범위가 커짐에 따라 단위 테스트를 유지 관리하기 어려워질 수 있습니다. 구현을 리팩토링하는 경우 테스트 이름도 바꿔야 합니다. 그리고 그들이 실제로 테스트하는 것에 대해 많이 말하지 않기 때문에 완료하기 전에 작성해야 하는 다른 테스트(있는 경우)가 무엇인지 알기가 어렵습니다.</p>\n</blockquote>\n<h2 id=\"테스트-주도-개발-단계\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C-%EB%8B%A8%EA%B3%84\" aria-label=\"테스트 주도 개발 단계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 주도 개발 단계</h2>\n<ul>\n<li>1단계 테스트 생성 및 실패 만들기</li>\n<li>2단계: 필요한 모든 수단을 사용하여 테스트 통과</li>\n<li>3단계: 리팩터링</li>\n</ul>\n<h3 id=\"예제로-살펴보기\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%A0%9C%EB%A1%9C-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"예제로 살펴보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예제로 살펴보기</h3>\n<ul>\n<li>시나리오\n<ul>\n<li>두개의 숫자를 받아 더하기 기능 구현</li>\n</ul>\n</li>\n</ul>\n<p>위 기능을 구현하는 것을 TDD  1단계,2단계,3단계 방식으로 진행해 보겠습니다.</p>\n<p><strong>- <code class=\"language-text\">Calculator</code> 클래스 만들기</strong></p>\n<p><strong>1단계 실패하라</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVQoz42S22rDMAyG/R5NZsuWfIiTLmFdR9YytjF20fd/n3/EZCUNDfTi4xeSLHSwcs6iCS2amJEagXgGEcEYU3TN0n8vR4kwks9oYkLfebDwZoGHCpIleA5IvgWLgMWVRK319cGkS5YF1ygJjCARw3BE7jr4EOB9QNNkOObN0bdQZAjaGLC1cNYWpyULcVOnVDrV2syqr53/T7FGaf2Euq6x2+1QVRXqmWLXVYndUq3sW5RjgXUMkYDJJnIwN9iitMYuYZgZtT984PX9G6fPC1I/wqY9Yjsgtj1S26NpB/j8DLlLD857iE/lsIEjlHRvOJ5+MH5d8HL+RUotsmN0EuAdg50ru7Ub0KTT3o0pKBMHSD4g9iPiMMJLRCBCtA52Pph5hPKNCH9SZxoWrFwCuQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/701e522cb8d1ddbcaff693af9e89c6d7/37523/tdd1.png\"\n        srcset=\"/static/701e522cb8d1ddbcaff693af9e89c6d7/e9ff0/tdd1.png 180w,\n/static/701e522cb8d1ddbcaff693af9e89c6d7/f21e7/tdd1.png 360w,\n/static/701e522cb8d1ddbcaff693af9e89c6d7/37523/tdd1.png 720w,\n/static/701e522cb8d1ddbcaff693af9e89c6d7/302a4/tdd1.png 1080w,\n/static/701e522cb8d1ddbcaff693af9e89c6d7/1e093/tdd1.png 1376w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">Calculator calculator = new Calculator();</code> 아직 <code class=\"language-text\">Calculator</code> 클래스가 없기때문에 당연히 실패합니다. 물론 이상할 수도 있지만, TDD 는 하나씩 쌓아가는 매력이 있습니다.  <code class=\"language-text\">Calculator</code> 를 만들어보겠습니다.</p>\n<p><strong>2단계 필요한 모든 수단을 사용하여 테스트 통과</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Calculator</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 715px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQoz42SwY6bMBRF8yNNCBNsbGxjbENokilqpGhGXfX/f+ZUdgNqu6iyuHo8FodjX3aP6TvDfKO/PujHBRNuqHDFhG/4+Y6YHrzZhJlu+GnBxgvCRE5dKKmVpxKWSrqSnRzfOd9/sHz8ZFo+MeOC6L+ihgsm3rDxivIz2k+Y4YxoNU1zomkapJQcj0eqqiozZ1dJz5uL9PNCvNyR7syXxnGQnr1w1Dpx6iK66+i9J01npnlmCIE0Tbi+p67rDbqr2oFD66l1oNaRvP+dUI6ilMZYWwA5GZ4t/zSsVmAlh2K0pnwkz7znZ2HRnSmQEBNpHAkpIYRAti1Cyn8Mn5A1277ChUVpjXUOH0KBdcaglEI/53+BW56GlXCbYYZmsww47Pe/czi8CGyfQNljXU9IkZgSSnel4VxGhuS5FvOaoXR01hJixA/DZhrHEed9KSm/zyW9DMwXXwp4FpHvtEylim35L9uWXwM1Kp0yPpFcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/9df00957aecdad1057507cf7f3d7df65/d0c0e/tdd2.png\"\n        srcset=\"/static/9df00957aecdad1057507cf7f3d7df65/e9ff0/tdd2.png 180w,\n/static/9df00957aecdad1057507cf7f3d7df65/f21e7/tdd2.png 360w,\n/static/9df00957aecdad1057507cf7f3d7df65/d0c0e/tdd2.png 715w\"\n        sizes=\"(max-width: 715px) 100vw, 715px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>- 두개의 숫자를 받아 더하기 기능 구현</strong></p>\n<p><strong>1단계 실패하라</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Calculator</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">plus</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n# 테스트 코드\n<span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"두개의 숫자를 받아 더하기 기능\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// given</span>\n    <span class=\"token class-name\">Calculator</span> calculator <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Calculator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// when</span>\n    <span class=\"token keyword\">int</span> actual <span class=\"token operator\">=</span> calculator<span class=\"token punctuation\">.</span><span class=\"token function\">plus</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// then</span>\n    <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>actual<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">add()</code> 테스트 코드는 30을 리턴받기를 예상했지만 <code class=\"language-text\">plus</code> 메소드는 별다른것 없이 0을 리턴하므로 당연히 실패합니다.<code class=\"language-text\">plus</code> 함수를 만드는 것만으로 충분한 의미가 있습니다.(<strong>실패하라</strong>)</p>\n<p><strong>2단계 필요한 모든 수단을 사용하여 테스트 통과</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Calculator</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">plus</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">30</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Calculator</code> 테스트를 통과 시키기 위해 30을 리턴시켜서 성공 시킬수 있습니다. 극단적인 방법을 써서 우선 성공하는지 <code class=\"language-text\">초록불</code>을 확인 하는 것도 하나의 TDD 과정중에 하나 일 수 있습니다;; ㅎㅎ</p>\n<p>이번에는 <code class=\"language-text\">plus</code> 메소드에 로직을 추가 해봅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Calculator</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">plus</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> i1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> i <span class=\"token operator\">+</span> i1<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><img src=\"assets/images/tdd4.png\" alt=\"img.png\"></p>\n<p><strong>3단계: 리팩터링</strong></p>\n<p>변수이름을 좀더 의미 있게 변경하겠습니다.<br>\n그리고 테스트 코드를 돌려봅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">plus</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> number1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> number2<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> number1 <span class=\"token operator\">+</span> number2<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트 코드가 초록불로 성공이 되었다면 기능 구현은 생각대로 되었다고 볼 수 있습니다.</p>\n<p>정말 간단하고 극단적인 예시로 짧게나마 TDD 를 알아보았습니다.<br>\nTDD 를 하며 느낀점은,</p>\n<ol>\n<li>짧게 짧게 테스트 코드를 실행하면서 현재 개발 진행 단계를 빠르게 알 수 있다.</li>\n<li>버그를 고치고 즉시 확인하며 어디가 문제인지 디버깅 하기 쉽다.</li>\n<li>기능별로 테스트 코드에 초록불이 뜨면 마음에 편암함이 느껴져서 코드에 자신감이 생긴다.</li>\n<li>리팩토링시 테스트 코드를 믿고 코드를 개선하기에 좋다.</li>\n</ol>\n<p>등등…</p>\n<hr>\n<hr>\n<blockquote>\n<p>처음에는 어렵겠지만 하다보면 분명히 많은 장점이 있는것 같습니다.<br>\nTDD 는 훈련이 중요하다고 생각합니다!</p>\n</blockquote>","frontmatter":{"date":"November 24, 2021","title":"간단하게 TDD 알아보기","categories":"프로그래밍","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/tdd/2021-11-24-tdd/"}},"site":{"siteMetadata":{"siteUrl":"https://wooobo.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/java/2021-11-21-jpa-1/","nextSlug":"/java/2021-11-12-builder-pattern/","prevSlug":"/tdd/2021-11-24-tdd/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}