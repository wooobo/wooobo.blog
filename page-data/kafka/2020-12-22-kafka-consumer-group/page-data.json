{"componentChunkName":"component---src-templates-blog-template-js","path":"/kafka/2020-12-22-kafka-consumer-group/","result":{"data":{"cur":{"id":"c069517a-ff7e-5068-9c36-aaa779173f59","html":"<h1 id=\"컨슈머-그룹\" style=\"position:relative;\"><a href=\"#%EC%BB%A8%EC%8A%88%EB%A8%B8-%EA%B7%B8%EB%A3%B9\" aria-label=\"컨슈머 그룹 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컨슈머 그룹?</h1>\n<p>지난번 카프카 파티션(<a href=\"/kafka-partition/\">링크</a>) 에 대해서 알아 보았습니다.<br>\n파티션을 만듬으로인해 Producer가 대량으로 토픽을 전송 하였을때,<br>\n토픽을 저장 할 때 병목현상을 해결 할 수 있는 이점을 알 수있었습니다.<br>\n그렇다면, 받는입장(Consumer)에서는 어떨까요?</p>\n<ul>\n<li>시나리오\n<ul>\n<li>이벤트 발생(Producer)이 10대의 서버에서 발생</li>\n<li>Consumer 1대</li>\n</ul>\n</li>\n</ul>\n<p>위 와 같은 상황이라면, 이벤트를 처리하는(consumer) 속도보다<br>\n이벤트를 쌓는(producer)가 더 많을 것으로 예상됩니다.<br>\n그렇다면, 컨슈머 또한 늘려서 해소해야 될것같습니다.<br>\nconsumer group을 활용하여 이벤트를 분산 수행 하는것에 대해알아 보겠습니다.</p>\n<blockquote>\n<p>의문, 컨슈머를 여러대 만들면 되는거 아닌가?<br>\n네, 만약 컨슈머 그룹이 아닌 컨슈머를 여러대 만든다면<br>\n여려대의 컨슈머가 모두 같은 메세지를 받습니다.<br>\n3개의 작업이 대기중일때\n3대의 컨슈머가 있다면 3대 모두 3개의 작업을 진행 할 것입니다.(중복 작업)<br>\n컨슈머 그룹을 활용 한다면 분산하여 작업을 진행 할 수 있습니다.<br>\n컨슈머 그룹에 컨슈머 3대가 있다면 각각 1개 의 작업을 분산하여 진행 하는것을 기대하고 예제를 진행해보겠습니다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 주키퍼 실행</span>\n$ bin/zookeeper-server-start.sh config/zookeeper.properties\n\n<span class=\"token comment\"># 카프카 실행 </span>\n$ bin/kafka-server-start.sh config/server.properties\n\n$ bin/kafka-topics.sh <span class=\"token parameter variable\">--zookeeper</span> localhost:2181 <span class=\"token parameter variable\">--list</span>\n<span class=\"token operator\">></span> __consumer_offsets\n<span class=\"token operator\">></span> partition-first-topic\n<span class=\"token operator\">></span> quickstart-events\n\n<span class=\"token comment\"># 컨슈머 그룹 실행 (기본적으로 컨슈머 실행 커맨드와 동입합니다. \"--group my-first-group\" 추가 합으로써 그룹이름을 지정해줍니다)</span>\n<span class=\"token comment\"># 터미널 2개를 열어서 각 터미널에 동일하게 2번 실행하겠습니다.</span>\n<span class=\"token comment\"># bin/kafka-console-producer.sh --topic partition-first-topic --bootstrap-server localhost:9092</span>\n<span class=\"token comment\"># producer를 실행하여 빠르게 메시지를 보내시면 2개로 각각 분산되어 빠르게 토픽을 받는것을 확인 하실수 있습니다.</span>\n$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class=\"token parameter variable\">--topic</span> partition-first-topic <span class=\"token parameter variable\">--group</span> my-first-group\n$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class=\"token parameter variable\">--topic</span> partition-first-topic <span class=\"token parameter variable\">--group</span> my-first-group</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnklEQVQ4y72SOQrEMAxFlcauvBQm9/CWeMn9r6VBKoZJyALBTPH4GNuS+F/Qe0di27adttZwXVcspezIOWNKifUMiDFiCGEYXHAkMHI6nrDW+vXn6NmZh8uy3AL06enRLxTIHeyh9/4/obwqeHf5KmVaYILCOUKeXS3w5WLP84zOObTWotaa1RjD0FkpxQghUEr5CEzThAAwDuo8suAHWg9/2iwBA9gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/13aa1bef7bd6d7c1a509efe8a5dd107c/37523/consumer-group-producer.png\"\n        srcset=\"/static/13aa1bef7bd6d7c1a509efe8a5dd107c/e9ff0/consumer-group-producer.png 180w,\n/static/13aa1bef7bd6d7c1a509efe8a5dd107c/f21e7/consumer-group-producer.png 360w,\n/static/13aa1bef7bd6d7c1a509efe8a5dd107c/37523/consumer-group-producer.png 720w,\n/static/13aa1bef7bd6d7c1a509efe8a5dd107c/302a4/consumer-group-producer.png 1080w,\n/static/13aa1bef7bd6d7c1a509efe8a5dd107c/07a9c/consumer-group-producer.png 1440w,\n/static/13aa1bef7bd6d7c1a509efe8a5dd107c/78302/consumer-group-producer.png 2798w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>컨슈머에 “my-first-group” 그룹을 지정하여 두개를 실행 하였고,<br>\n메시지가 나뉘어서 들어오는것을 확인 할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 컨슈머 그룹 리스트 확인하기\n$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list\n> my-first-group # 현재 1개의 컨슈머 그룹이 있는것을 확인할수있습니다.\n\n# \"my-first-group\" 해당 컨슈머 그룹에 대한 정보 가져오기\n$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group my-first-group\nGROUP           TOPIC                 PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID\nmy-first-group  partition-first-topic 1          12              13              1               -               -               -\nmy-first-group  partition-first-topic 2          14              15              1               -               -               -\nmy-first-group  partition-first-topic 0          12              13              1               -               -               -\n\n# 위의 정보에 대해서 알아보겠습니다.\n# PARTITION: 파티션 번호\n# CURRENT-OFFSET: 최근 가져온 offset 번호\n# LOG-END-OFFSET: 현재 쌓여져 있는 마지막 offset 번호\n# LAG: 아직 가져오지 못한 토픽 갯수\n# 현재 파티션 3개에 각각 1개씩 LAG가 발생한것을  확인 하실 수 있습니다.\n# 이는 3개의 토픽이 컨슈머가 가져오기 전이라는 뜻입니다.</code></pre></div>\n<table>\n<thead>\n<tr>\n<th align=\"center\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA40lEQVQoz5VS2QqDQAz0/39PEF+8Hrxv8QCvKRPIorTUNhCyu5nM5rLwh5znKXbbNszzbHSaJizLIn5Lgb8qhcG+78PzPIRhCNd1kSQJjuOApaB/ZN93jOOItm2R57lkyExNhmQmiMozS/pmiaOQpK7r22dC2Pc9mqZB13UC+GTLsrxZvjPDNE0xDIPpsRASQEICGEBbVdXtXhSFYNgr3hWfZdk7oZbxVCItP9ABqZ9qCH8ZCgO0LXEcS0XM6hqr58e1oazrKiti2zaCIIDjOIiiyGSuOFPy0yJreboJqle/TvkFkn8NeMMOvN0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/f2a51d6d784db8a6d915b3cbadc4866a/37523/kafka-offset-lag.png\"\n        srcset=\"/static/f2a51d6d784db8a6d915b3cbadc4866a/e9ff0/kafka-offset-lag.png 180w,\n/static/f2a51d6d784db8a6d915b3cbadc4866a/f21e7/kafka-offset-lag.png 360w,\n/static/f2a51d6d784db8a6d915b3cbadc4866a/37523/kafka-offset-lag.png 720w,\n/static/f2a51d6d784db8a6d915b3cbadc4866a/302a4/kafka-offset-lag.png 1080w,\n/static/f2a51d6d784db8a6d915b3cbadc4866a/e8814/kafka-offset-lag.png 1392w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\"><em>위 그림은 6까지 가져왔고 마지막 메시지는 8이므로 LAG가 2개 발생 상태입니다.</em></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th align=\"center\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 519px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQoz42S6Y6DMAyEef/n4y8SApFwhPsoR4tXn6uw3dVu1UhWHMeeGTsJzvOUT4y1LItEUSTHcej5r5xAPlwUANj3vazr+m9OMM+zNE2jScMwyDiOWuT9ruuEHOec2rZtet73XUEej4cqvhRSnOf5xQ4QIN5v21aBIa2qSs9YHMeSpqkYY8Raq8AK6JFZqEQBu/dRArDv4n6/yzRNKiJJEsmyTMqy/FZIG7ChsK5rZSf22/etA+i7wgBjvxS+DhVQil4NNcRRCDDzQilkjIA4/g+FSKeQC9hRw9yI9f3zccbx2TaLUXAXhqF+Iwgvhf6V2NfbTZOdq3Q2kDFwa4wYa8VkRlWjhjzIIcN/+w/naRJjrCa7qpKyKMTVjRRFoQ/07q9+Aeu0BhZx3HuEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/14078c66fc853c24db509ade03d500cf/b23ad/consumer-group.png\"\n        srcset=\"/static/14078c66fc853c24db509ade03d500cf/e9ff0/consumer-group.png 180w,\n/static/14078c66fc853c24db509ade03d500cf/f21e7/consumer-group.png 360w,\n/static/14078c66fc853c24db509ade03d500cf/b23ad/consumer-group.png 519w\"\n        sizes=\"(max-width: 519px) 100vw, 519px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\"><em>출처 <a href=\"https://www.confluent.io/\">https://www.confluent.io/</a></em></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"참조링크\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EC%A1%B0%EB%A7%81%ED%81%AC\" aria-label=\"참조링크 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>&#x3C;참조링크></h4>\n<p><a href=\"https://www.confluent.io/blog/tutorial-getting-started-with-the-new-apache-kafka-0-9-consumer-client/\">tutorial-getting-started-with-the-new-apache-kafka-0-9-consumer-client</a></p>","excerpt":"컨슈머 그룹? 지난번 카프카 파티션(링크) 에 대해서 알아 보았습니다. 파티션을 만듬으로인해 Producer가 대량으로 토픽을 전송 하였을때, 토픽을 저장 할 때 병목현상을 해결 할 수 있는 이점을 알 수있었습니다. 그렇다면, 받는입장(Consumer)에서는 어떨까요? 시나리오 이벤트 발생(Producer)이 10대의 서버에서 발생 Consumer 1대 위 와 같은 상황이라면, 이벤트를 처리하는(consumer) 속도보다 이벤트를 쌓는(producer)가 더 많을 것으로 예상됩니다. 그렇다면, 컨슈머 또한 늘려서 해소해야 될것같습니다. consumer group을 활용하여 이벤트를 분산 수행 하는것에 대해알아 보겠습니다. 의문, 컨슈머를 여러대 만들면 되는거 아닌가? 네, 만약 컨슈머 그룹이 아닌 컨슈머를 여러대 만든다면 여려대의 컨슈머가 모두 같은 메세지를 받습니다. 3개의 작업이 대기중일때\n3대의 컨슈머가 있다면 3대 모두 3개의 작업을 진행 할 것입니다.(중복 작업) 컨슈머 …","frontmatter":{"date":"December 22, 2020","title":"도대체 카프카 컨슈머 그룹(consumer group)?","categories":"kafka","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/kafka/2020-12-22-kafka-consumer-group/"}},"next":{"id":"3df644f1-560a-5b03-9d0e-d2517a5b5822","html":"<h1 id=\"카프카-파티션\" style=\"position:relative;\"><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4-%ED%8C%8C%ED%8B%B0%EC%85%98\" aria-label=\"카프카 파티션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>카프카 파티션?</h1>\n<p>카프카는 초당 수백만개의 메시지를 전송하고 처리를 제공하는 분산 스트리밍 플랫폼입니다.<br>\n처리성능을 높이기 위해 토픽 저장을 병렬화 할 수 있습니다.<br>\n그러한 방법은 브로커에 파티션을 나누는 것입니다.<br>\n하지만, 파티션은 늘리는것은 가능하지만 줄이는 것은 안되기 때문에 주의 해야합니다.<br>\n파티션 줄이고 싶다면 토픽을 삭제밖에 방법이 없습니다.<br>\nex)<br>\n1개의 파티션이 1분에 10개의 메시지를 받을 수 경우를 가정해보겠습니다.<br>\n프로듀서에서 1분에 50개의 메세지를 보낸다면,<br>\n토픽의 파티션을 5개로 늘려 처리 성능을 높여서 병목현상을 막을수 있을것입니다.</p>\n<h2 id=\"커맨드로-따라-해보기\" style=\"position:relative;\"><a href=\"#%EC%BB%A4%EB%A7%A8%EB%93%9C%EB%A1%9C-%EB%94%B0%EB%9D%BC-%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"커맨드로 따라 해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>커맨드로 따라 해보기</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 주키퍼 실행</span>\n$ bin/zookeeper-server-start.sh config/zookeeper.properties\n\n<span class=\"token comment\"># 카프카 실행 </span>\n$ bin/kafka-server-start.sh config/server.properties\n\n<span class=\"token comment\"># 생성된 토픽 리스트 가져오기</span>\n$ bin/kafka-topics.sh <span class=\"token parameter variable\">--zookeeper</span> localhost:2181 <span class=\"token parameter variable\">--list</span>\n<span class=\"token operator\">></span> __consumer_offsets\n\n<span class=\"token comment\"># 파티션 3개 토픽 생성하기</span>\n$ bin/kafka-topics.sh <span class=\"token parameter variable\">--zookeeper</span> localhost:2181 <span class=\"token parameter variable\">--topic</span> partition-first-topic <span class=\"token parameter variable\">--create</span> <span class=\"token parameter variable\">--partitions</span> <span class=\"token number\">3</span> --replication-factor <span class=\"token number\">1</span>\n<span class=\"token operator\">></span> Created topic partition-first-topic.\n\n<span class=\"token comment\"># 다시 토픽 리스트 확인하기</span>\n$ bin/kafka-topics.sh <span class=\"token parameter variable\">--zookeeper</span> localhost:2181 <span class=\"token parameter variable\">--list</span>\n<span class=\"token operator\">></span> __consumer_offsets\n<span class=\"token operator\">></span> partition-first-topic <span class=\"token comment\">## 토픽이 생성된것을 확인하실 수 있습니다.</span>\n\n<span class=\"token comment\"># 토픽 기본정보 확인하기</span>\n$ bin/kafka-topics.sh <span class=\"token parameter variable\">--zookeeper</span> localhost:2181 <span class=\"token parameter variable\">--describe</span> <span class=\"token parameter variable\">--topic</span> partition-first-topic\n<span class=\"token operator\">></span> Topic: partition-first-topic\tPartitionCount: <span class=\"token number\">3</span>\tReplicationFactor: <span class=\"token number\">1</span>\tConfigs:\n    Topic: partition-first-topic\tPartition: <span class=\"token number\">0</span>\tLeader: <span class=\"token number\">0</span>\tReplicas: <span class=\"token number\">0</span>\tIsr: <span class=\"token number\">0</span>\n    Topic: partition-first-topic\tPartition: <span class=\"token number\">1</span>\tLeader: <span class=\"token number\">0</span>\tReplicas: <span class=\"token number\">0</span>\tIsr: <span class=\"token number\">0</span>\n    Topic: partition-first-topic\tPartition: <span class=\"token number\">2</span>\tLeader: <span class=\"token number\">0</span>\tReplicas: <span class=\"token number\">0</span>\tIsr: <span class=\"token number\">0</span>\n<span class=\"token operator\">=</span><span class=\"token operator\">></span> 파티션 <span class=\"token number\">3</span>개가 생성된것을 확인할 수 있습니다.\n   ReplicationFactor는 토픽을 복제할 브로커 수입니다. 현재는 브로커 <span class=\"token number\">1</span>개로만 테스트 하고 있으므로 <span class=\"token string\">\"1\"</span>입니다.\n   \n<span class=\"token comment\"># 이제 토픽을 넣어 보겠습니다.</span>\n<span class=\"token comment\"># 파티션이 3개이니 3개로 분산해서 저장되는것을 예상하고 진행해보겠습니다.</span>\n<span class=\"token comment\"># 토픽 전송</span>\n$ bin/kafka-console-producer.sh <span class=\"token parameter variable\">--topic</span> partition-first-topic --bootstrap-server localhost:9092\n<span class=\"token operator\">></span>send 01\n<span class=\"token operator\">></span>send 02\n<span class=\"token operator\">></span>send 03\n<span class=\"token operator\">></span>send 04\n<span class=\"token operator\">></span>send 05\n\n<span class=\"token comment\"># 5개 메시지를 전송 하였습니다.</span>\n\n<span class=\"token comment\"># 컨슈머로 토픽을 받아 보겠습니다. (\"--property print.partition=true\" 추가하여 파티션을 출력합니다) </span>\n$ bin/kafka-console-consumer.sh <span class=\"token parameter variable\">--topic</span> partition-first-topic --from-beginning <span class=\"token parameter variable\">--property</span> <span class=\"token assign-left variable\">print.partition</span><span class=\"token operator\">=</span>true --bootstrap-server localhost:9092\n<span class=\"token operator\">></span> Partition:1\tsend 01\n<span class=\"token operator\">></span> Partition:1\tsend 03\n<span class=\"token operator\">></span> Partition:1\tsend 05\n<span class=\"token operator\">></span> Partition:2\tsend 04\n<span class=\"token operator\">></span> Partition:0\tsend 02\n\n<span class=\"token comment\"># 보시면 아시겠지만 파티션 0,1,2로 분산되어 저장된것을 확인하실 수 있습니다.</span>\n<span class=\"token comment\"># 눈에 띄는것이, 토픽을 가져올때는 순서대로 가져오지 않는다는걸 확인 할 수 있습니다.</span></code></pre></div>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<ol>\n<li>토픽에 파티션을 추가하여 토픽을 생성해보았습니다.</li>\n<li>토픽 전송 후 파티션을 확인하였을때 분산되어 저장되는것을 확인 할 수 있었습니다.</li>\n<li>토픽을 가져올때는 순서대로 가져오지 않는다는걸 확인 하였습니다.</li>\n</ol>","frontmatter":{"date":"December 21, 2020","title":"도대체 카프카 토픽 파티션?","categories":"kafka","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/kafka/2020-12-21-kafka-partition/"}},"prev":{"id":"23705888-6cc4-587d-b484-da8331554251","html":"<h1 id=\"kafka-connect를-활용하여-file-source-해보기\" style=\"position:relative;\"><a href=\"#kafka-connect%EB%A5%BC-%ED%99%9C%EC%9A%A9%ED%95%98%EC%97%AC-file-source-%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"kafka connect를 활용하여 file source 해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kafka Connect를 활용하여 File Source 해보기</h1>\n<ol>\n<li>kafka, zookeeper가 실행되어있어야 합니다.(카프가가 없으시다면 공식 홈페이지에서 <a href=\"https://www.apache.org/dyn/closer.cgi?path=/kafka/2.7.0/kafka_2.13-2.7.0.tgz\">다운로드</a>)\n(처음 이시라면 <a href=\"https://kth12.github.io/kafka-quick-start/\">참고</a>)</li>\n<li>kafka/config 폴더를 열어보면 아래의 파일들이 존재합니다.\nconnect-file-sink.properties<br>\nconnect-standalone.properties\n위 파일들을 확용하여 File을 감시해보겠습니다.</li>\n</ol>\n<hr>\n<h3 id=\"configconnect-file-sourceproperties\" style=\"position:relative;\"><a href=\"#configconnect-file-sourceproperties\" aria-label=\"configconnect file sourceproperties permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>config/connect-file-source.properties</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>local-file-source\n<span class=\"token assign-left variable\">connector.class</span><span class=\"token operator\">=</span>FileStreamSource\n<span class=\"token assign-left variable\">tasks.max</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>\n<span class=\"token assign-left variable\">file</span><span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/example/source.txt\n<span class=\"token assign-left variable\">topic</span><span class=\"token operator\">=</span>connect-test</code></pre></div>\n<p>위 설정 파일은, connect 이름 / connect 라이브러리(connect class) / Source Topic 이름  등등을 설정 할수 있습니다.</p>\n<h3 id=\"configconnect-standaloneproperties\" style=\"position:relative;\"><a href=\"#configconnect-standaloneproperties\" aria-label=\"configconnect standaloneproperties permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>config/connect-standalone.properties</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">bootstrap.servers</span><span class=\"token operator\">=</span>localhost:9092\n<span class=\"token assign-left variable\">key.converter</span><span class=\"token operator\">=</span>org.apache.kafka.connect.json.JsonConverter\n<span class=\"token assign-left variable\">value.converter</span><span class=\"token operator\">=</span>org.apache.kafka.connect.json.JsonConverter\n<span class=\"token assign-left variable\">key.converter.schemas.enable</span><span class=\"token operator\">=</span>true\n<span class=\"token assign-left variable\">value.converter.schemas.enable</span><span class=\"token operator\">=</span>true\n\n<span class=\"token assign-left variable\">offset.storage.file.filename</span><span class=\"token operator\">=</span>/tmp/connect.offsets\n<span class=\"token assign-left variable\">offset.flush.interval.ms</span><span class=\"token operator\">=</span><span class=\"token number\">10000</span></code></pre></div>\n<p>카프카 서버 주소 설정 / Source key, value 타입 지정 / 감시할 파일 이름 등등을 설정 할 수 있습니다.</p>\n<h2 id=\"실행-해보기\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89-%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"실행 해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행 해보기</h2>\n<p>기본 설정 파일에 대해 알아보았고 실행 예제를 알아보겠습니다.</p>\n<p>실행에 앞서 감시할 파일을 생성하여 줍니다.</p>\n<p>저같은 경우 “source.txt” 라는 파일을 생성해주었습니다.</p>\n<h3 id=\"실행-커맨드\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89-%EC%BB%A4%EB%A7%A8%EB%93%9C\" aria-label=\"실행 커맨드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행 커맨드</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ bin/connect-standalone.sh config/connect-standalone.properties config/connect-file-source.properties\n\nINFO Kafka startTimeMs: <span class=\"token number\">1615649461180</span> <span class=\"token punctuation\">(</span>org.apache.kafka.common.utils.AppInfoParser:121<span class=\"token punctuation\">)</span>\nINFO <span class=\"token punctuation\">[</span>Producer <span class=\"token assign-left variable\">clientId</span><span class=\"token operator\">=</span>connector-producer-local-file-source-0<span class=\"token punctuation\">]</span> Cluster ID: ovrhH6KaQnOfZ0SseIBV6g <span class=\"token punctuation\">(</span>org.apache.kafka.clients.Metadata:279<span class=\"token punctuation\">)</span>\nINFO WorkerSourceTask<span class=\"token punctuation\">{</span>id<span class=\"token operator\">=</span>local-file-source-0<span class=\"token punctuation\">}</span> Source task finished initialization and start <span class=\"token punctuation\">(</span>org.apache.kafka.connect.runtime.WorkerSourceTask:233<span class=\"token punctuation\">)</span>\nINFO Created connector local-file-source <span class=\"token punctuation\">(</span>org.apache.kafka.connect.cli.ConnectStandalone:112<span class=\"token punctuation\">)</span>\n \n<span class=\"token comment\"># 위 출력 로그처럼 정상적으로 실행이 되었다면 파일을 수정해보겠습니다.</span>\n\n$ <span class=\"token function\">cat</span> <span class=\"token operator\">>></span> source.txt\n\thi\n\thello\n\n<span class=\"token comment\"># 감시 파일(source.txt)에 내용을 입력 하였습니다.</span>\n\n$ bin/kafka-console-consumer.sh <span class=\"token parameter variable\">--topic</span> connect-test --from-beginning  --bootstrap-server localhost:9092\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"schema\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false<span class=\"token punctuation\">}</span>,<span class=\"token string\">\"payload\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"hi\"</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"schema\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false<span class=\"token punctuation\">}</span>,<span class=\"token string\">\"payload\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 파일에서 입력했던 내용들을 컨슘되는것을 확인할 수 있습니다.</span>\n<span class=\"token comment\"># 터미널 창을 하나 더 열어 내용을 추가적으로 넣어서 실시간 동기화 되는지 확인해보겠습니다.</span></code></pre></div>\n<h3 id=\"실행-화면\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89-%ED%99%94%EB%A9%B4\" aria-label=\"실행 화면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행 화면</h3>\n<p><img src=\"/100d83b03f60cb767cde16c10db7e29e/kafkaconnectgif.gif\" alt=\"img.png\"></p>\n<hr>\n<h3 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h3>\n<p>가장 간단하게 카프카 커넥트 예제에 대해서 알아 보았습니다.</p>\n<p>카프카 커넥트는 여러 플러그인을 붙여 다양한 데이터 소스를 커넥트 할 수 있습니다.</p>\n<p>예로, debezium 오픈소스 플러그인을 활용하면</p>\n<p>mysql, mongoDB, PostgreSQL,Oracle,SqlServer 등 데이터 베이스를 감시하고 데이터를 Source 할 수 있습니다.</p>","frontmatter":{"date":"March 14, 2021","title":"Kafka connect File Source 알아보기 & 실행","categories":"kafka","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/kafka/2021-03-14-kafka-connect-action/"}},"site":{"siteMetadata":{"siteUrl":"https://wooobo.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/kafka/2020-12-22-kafka-consumer-group/","nextSlug":"/kafka/2020-12-21-kafka-partition/","prevSlug":"/kafka/2021-03-14-kafka-connect-action/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}