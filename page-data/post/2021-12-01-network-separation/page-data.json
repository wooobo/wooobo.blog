{"componentChunkName":"component---src-templates-blog-template-js","path":"/post/2021-12-01-network-separation/","result":{"data":{"cur":{"id":"f3c081ef-a97f-5e41-9dc8-40d5b0463fc3","html":"<h1 id=\"aws-망분리\" style=\"position:relative;\"><a href=\"#aws-%EB%A7%9D%EB%B6%84%EB%A6%AC\" aria-label=\"aws 망분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>“AWS 망분리”</h1>\n<p>인프라 담당이 아니라면 깊이 있게 알기 힘들겠지만, 기본적으로 알아야 하는 부분이 있다고 생각합니다.<br>\n“망분리”에 대해 알아 보겠습니다.</p>\n<h2 id=\"망분리\" style=\"position:relative;\"><a href=\"#%EB%A7%9D%EB%B6%84%EB%A6%AC\" aria-label=\"망분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>망분리??</h2>\n<p>망분리란 내부망과 외부망 등을 분리하여 외부의 침입을 막는거나 보안 이슈를 관리하기 위함입니다.<br>\n예를 들면, 중요한 DB 혹은 사내전용 서버 등을 내부망(사내망)으로 분리하여 외부 노출을 분리합니다.\n일반 고객이 접속해야하는 웹서비스 같은 경우 외부망을 오픈하여 외부 인터넷과 접속 할 수 있게 합니다.<br>\n개인적인 실무 경험상(일반적인 웹개발자) 심리적으로 굉장히 안정이 됩니다. 인프라 혹은 보안 담당자 없이 AWS 구축하다 보면 무분별하게 생성되는 <code class=\"language-text\">PEM 파일</code>, 그리고 <code class=\"language-text\">인바운드 IP</code> 설정 등 시간이 지날 수록 서버 관리 영역이 관리가 힘들 정도로 난잡해 집니다.\n그때 <code class=\"language-text\">private subnet</code> 과 <code class=\"language-text\">public subnet</code>을 분리해 보았는데 관리적인 측면에서 굉장한 이득을 볼 수 있었고, 작은 팀에서 AWS 로 서비스를 운용할때 보안의 불안함이 있는데 이부분에 대해 어느정도<code class=\"language-text\">심리적안정</code> 주는 경험했었습니다.</p>\n<p>망분리에는 물리적 망분리와 논리적 망분리가 있습니다.<br>\n이에 대한 설명은 링크로 대체하겠습니다. <a href=\"https://www.ahnlab.com/kr/site/securityinfo/secunews/secuNewsView.do?menu_dist=2&#x26;seq=14140\">링크</a></p>\n<h2 id=\"aws-에서-망분리-할려면-어떻게\" style=\"position:relative;\"><a href=\"#aws-%EC%97%90%EC%84%9C-%EB%A7%9D%EB%B6%84%EB%A6%AC-%ED%95%A0%EB%A0%A4%EB%A9%B4-%EC%96%B4%EB%96%BB%EA%B2%8C\" aria-label=\"aws 에서 망분리 할려면 어떻게 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS 에서 망분리 할려면 어떻게?</h2>\n<p>우선 VPC 와 Subnet 에 대해서 간단하게 알고 가야 합니다.<br>\n처음 접하시는 분이라면 개념정도로만 알고 가면됩니다.(저도 깊이있게 잘 알지는 모릅니다. 개념만 알고있는정도)</p>\n<p><strong><a href=\"https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/what-is-amazon-vpc.html\">Amazon VPC란 무엇인가?</a></strong></p>\n<blockquote>\n<p>Amazon Virtual Private Cloud(Amazon VPC)를 이용하면 사용자가 정의한 가상 네트워크로 AWS 리소스를 시작할 수 있습니다. 이 가상 네트워크는 의 확장 가능한 인프라를 사용한다는 이점과 함께 고객의 자체 데이터 센터에서 운영하는 기존 네트워크와 매우 유사합니다<br>\nAWS Amazon VPC는 Amazon EC2의 네트워킹 계층입니다.</p>\n</blockquote>\n<blockquote>\n<p>다음은 VPC의 핵심 개념입니다.</p>\n<ul>\n<li>Virtual Private Cloud(VPC) — 사용자의 AWS 계정 전용 가상 네트워크입니다.</li>\n<li>서브넷 — VPC의 IP 주소 범위입니다.</li>\n<li>라우팅 테이블 — 네트워크 트래픽을 전달할 위치를 결정하는 데 사용하는 라우팅이라는 이름의 규칙 집합입니다.</li>\n<li>인터넷 게이트웨이 — VPC의 리소스와 인터넷 간의 통신을 활성화하기 위해 VPC에 연결하는 게이트웨이입니다.</li>\n<li>VPC 엔드포인트 - 인터넷 게이트웨이, NAT 디바이스, VPN 연결 또는 AWS Direct Connect 연결을 필요로 하지 않고 PrivateLink 구동 지원 AWS 서비스 및 VPC 엔드포인트 서비스에 VPC를 비공개로 연결할 수 있습니다. VPC의 인스턴스는 서비스의 리소스와 통신하는 데 퍼블릭 IP 주소를 필요로 하지 않습니다. VPC와 기타 서비스 간의 트래픽은 Amazon 네트워크를 벗어나지 않습니다. 자세한 내용은 AWS PrivateLink 및 VPC 엔드포인트 단원을 참조하십시오.</li>\n<li>CIDR 블록 — 클래스 없는 도메인 간 라우팅입니다. 인터넷 프로토콜 주소 할당 및 라우팅 집계 방법입니다. 자세한 내용은 Wikipedia의 Classless Inter-Domain Routing을 참조하십시오.</li>\n</ul>\n</blockquote>\n<p>우선 처음 접하시는 분이라면, VPC, Subnet,라우팅 테이블, 인터넷게이트웨이(igw) 만 알아도 좋습니다.</p>\n<ul>\n<li>VPC\n<ul>\n<li>VPC 는 간단하게 하나의 서비스 네트워크 단위라고 생각하면됩니다.</li>\n</ul>\n</li>\n<li>서브넷\n<ul>\n<li>서브넷 은 VPC 를 좀 더 세부적인 대역폭으로 나누는 네트워크입니다.</li>\n</ul>\n</li>\n<li>라우트 테이블\n<ul>\n<li>라우트 테이블은 다른 서브넷 혹은 외부 인터넷과의 통신 연결을 위한 정보를 가지고 있습니다.</li>\n</ul>\n</li>\n<li>인터넷 게이트 웨이\n<ul>\n<li>인터넷 게이트 웨이는 외부 인터넷과 연결합니다. 인터넷게이트웨이를 통하지 않고서는 외부인터넷과 차단된 상태입니다.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 682px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVQ4y52Uu28TQRDG/a8i8RfQ0NNRUCEhEA0dokABKpQIEI8iRZCCCQ8X4MSJz/fwPfZ2bx93vvuhXTuJI5BAjDSa1d7Md9/MfNoR/2BZljE9Pqbrur/mjqSUxHFMmqYk8YIkjqmlxFqLMQbnHGVZhZxGXd5fuLVYH3VD27aMPFC8WJCkKdGyJFosqIUIhd7rumaZZVjX4nqugJ2DW+dogaIsGXkG3jqj0ONdWq0w1qG1DslKKUohUEWKnH1FG4c2LVo3IUcbiyqXkE5IojkjfzkAVVFQ7D+mOjvCuA7drAtkLahNh/x5iHl5hzqbUuVnCLVmX2uLin5gXtwink0ZeRYwIBtHupgg0m+0PaEN162wbUe/6pCixKqG7OwzYrKHfHKTZj4JY/Aj8fNL0+wcEISoUFJB6+iNpO8cq0YwGIluB2rVhDbtsN6m+fgMBhXOfg9eAT5uMTQkP46IHlwjenid5mCH+c5txN5dbjw64MOn41CcjN8hXt0P5+f7U96M54iq2DBMtxj6eVQl5WxCfvKdTpVokVOlEaKxlGUZ2luM37PcvRdqnr79wuvDkwDofgMUgkoIpDaBrZeJcS21VDhn8Xp1XkaNoWhaZqeniDzFNjVFUbBara4C+o15CXmRFnkeBO4TyqJAbwS+tgEl6/AD31XbdUGPFy17aXjzCf58IdaNsLc96G6jz21xV1XFMAwkSXLJ0Fvf92Fbnv62/+lu+9u5BYZ+dnmehwfAx//x5XIZosf6BZSmLLTXT3M0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/5df96b3abe09bb590bd11c546859211c/160a3/aws-vpc.png\"\n        srcset=\"/static/5df96b3abe09bb590bd11c546859211c/e9ff0/aws-vpc.png 180w,\n/static/5df96b3abe09bb590bd11c546859211c/f21e7/aws-vpc.png 360w,\n/static/5df96b3abe09bb590bd11c546859211c/160a3/aws-vpc.png 682w\"\n        sizes=\"(max-width: 682px) 100vw, 682px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<a href=\"https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/how-it-works.html\">출처</a></p>\n<p>AWS 서비스가 있고 리전 별로 VPC 가 나누어 집니다.<br>\nVPC 안에서 <code class=\"language-text\">private subnet</code> 과 <code class=\"language-text\">public subnet</code> 이 분리 되어 있는것을 확인 할 수 있습니다.\nsubnet 안에 <code class=\"language-text\">ec2</code> 인스턴스 와 <code class=\"language-text\">RDS</code> 등 노드들이 존재합니다.<br>\n그리고 이러한 서브넷관의 연결 혹은 인터넷과의 연결을 라우트 테이블에서 담당합니다.</p>\n<p>리전은 다양하게 있습니다. 로그인 후 리전을 선택 하고 VPC 생성을 진행해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">아시아 태평양 (홍콩) ap-east-1\n아시아 태평양 (뭄바이) ap-south-1\n아시아 태평양 (오사카) ap-northeast-3\n아시아 태평양 (서울) ap-northeast-2\n아시아 태평양 (싱가포르) ap-southeast-1\n아시아 태평양 (시드니)ap-southeast-2\n아시아 태평양 (도쿄) ap-northeast-1</code></pre></div>\n<p>AWS 로그인 후 <code class=\"language-text\">아시아 태평양 (서울) ap-northeast-2</code>으로 접속해서 VPC 를 만들어 보겠습니다.<br>\n<a href=\"https://ap-northeast-2.console.aws.amazon.com/vpc/home?region=ap-northeast-2#vpcs:\">aws vpc 페이지</a></p>\n<h3 id=\"vpc-생성\" style=\"position:relative;\"><a href=\"#vpc-%EC%83%9D%EC%84%B1\" aria-label=\"vpc 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VPC 생성</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 682px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACOklEQVQ4y52Uu28TQRDG/a8i8RfQ0NNRUCEhEA0dokABKpQIEI8iRZCCCQ8X4MSJz/fwPfZ2bx93vvuhXTuJI5BAjDSa1d7Md9/MfNoR/2BZljE9Pqbrur/mjqSUxHFMmqYk8YIkjqmlxFqLMQbnHGVZhZxGXd5fuLVYH3VD27aMPFC8WJCkKdGyJFosqIUIhd7rumaZZVjX4nqugJ2DW+dogaIsGXkG3jqj0ONdWq0w1qG1DslKKUohUEWKnH1FG4c2LVo3IUcbiyqXkE5IojkjfzkAVVFQ7D+mOjvCuA7drAtkLahNh/x5iHl5hzqbUuVnCLVmX2uLin5gXtwink0ZeRYwIBtHupgg0m+0PaEN162wbUe/6pCixKqG7OwzYrKHfHKTZj4JY/Aj8fNL0+wcEISoUFJB6+iNpO8cq0YwGIluB2rVhDbtsN6m+fgMBhXOfg9eAT5uMTQkP46IHlwjenid5mCH+c5txN5dbjw64MOn41CcjN8hXt0P5+f7U96M54iq2DBMtxj6eVQl5WxCfvKdTpVokVOlEaKxlGUZ2luM37PcvRdqnr79wuvDkwDofgMUgkoIpDaBrZeJcS21VDhn8Xp1XkaNoWhaZqeniDzFNjVFUbBara4C+o15CXmRFnkeBO4TyqJAbwS+tgEl6/AD31XbdUGPFy17aXjzCf58IdaNsLc96G6jz21xV1XFMAwkSXLJ0Fvf92Fbnv62/+lu+9u5BYZ+dnmehwfAx//x5XIZosf6BZSmLLTXT3M0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/5df96b3abe09bb590bd11c546859211c/160a3/aws-vpc.png\"\n        srcset=\"/static/5df96b3abe09bb590bd11c546859211c/e9ff0/aws-vpc.png 180w,\n/static/5df96b3abe09bb590bd11c546859211c/f21e7/aws-vpc.png 360w,\n/static/5df96b3abe09bb590bd11c546859211c/160a3/aws-vpc.png 682w\"\n        sizes=\"(max-width: 682px) 100vw, 682px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>이름 : my-first-vpc<br>\nIPv4 CIDR : 192.168.240.0/24</p>\n<p>해당 정보말고 특별한 입력은 없습니다.\n여기서 <code class=\"language-text\">IPv4 CIDR : 192.168.240.0/24</code> 는 VPC 망에서 사용 할 IP 영역입니다.</p>\n<p>IP 대역은 <a href=\"https://cidr.xyz/\">링크</a>에서 확인 할 수 있습니다.<br>\n<img src=\"../../assets/images/vpc-cidr.png\" alt=\"img.png\"></p>\n<p>저는 <code class=\"language-text\">192.168.240.0/24</code>로 하였는데,<br>\n사용가능한 IP 갯수 :256<br>\n사용가능 대역폭 : 192.168.240.1 ~ 192.168.240.254</p>\n<p><strong>CIDR</strong> 네트워크 블록에 대해서는 위키백과 링크 참고해주세요~<a href=\"https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%EB%8D%94_(%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%82%B9)\">위키백과</a></p>\n<p>간략하게 보자면,<br>\n..<br>\n<code class=\"language-text\">/26</code> 64개 사용가능<br>\n<code class=\"language-text\">/27</code> 32개 사용가능<br>\n..<br>\n<code class=\"language-text\">/24</code> 256개 사용가능<br>\n..</p>\n<p>vpc 생성된 리스트 캡처<br>\n<img src=\"../../assets/images/awc-vpc-list.png\" alt=\"img.png\"></p>\n<h3 id=\"서브넷subnet-생성\" style=\"position:relative;\"><a href=\"#%EC%84%9C%EB%B8%8C%EB%84%B7subnet-%EC%83%9D%EC%84%B1\" aria-label=\"서브넷subnet 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>서브넷(subnet) 생성</h3>\n<p><a href=\"https://ap-northeast-2.console.aws.amazon.com/vpc/home?region=ap-northeast-2#subnets:\">서브넷 페이지</a></p>\n<p><strong>1. 생성한 VPC 를 선택합니다.</strong></p>\n<p><img src=\"../../assets/images/aws-subnet-create01.png\" alt=\"img.png\"></p>\n<p><strong>2. 서브넷 설정</strong></p>\n<p>“가용 영역”이란것은 (AWS의 AZ(Availablity Zone)) 물리적으로 나뉘는 것이라고 보면됩니다. 같은 웹서비스라도 서로 다른 멀티 가용영역을 서브넷을 생성해서 운용하는게 추후 재해 재난시 한쪽 IDC 에 문제가 생겨도 다른 가용영역 서버로 구동 할 수 있기 때문입니다.<br>\n“IPv4 CIDR” 블록 정보에 <code class=\"language-text\">192.240.240.0/26</code> 이라고 표기 하였는데요,<br>\n이는 <code class=\"language-text\">192.240.240.1</code> ~ <code class=\"language-text\">192.240.240.62</code> 대역을 사용하겠다 입니다. 대역폭 확인은 위에서 말씀드린것처럼 <a href=\"https://cidr.xyz/\">링크</a> 여기서 확인하기 쉽습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.55555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB4UlEQVQ4y5VUy5KbMBDkw3PNKR+TSw75jT1kb67KGrDNU0I8BAjorR4eZbP2rldVU0KF1Jqebo2ntMbhcMD/tyOapoG1Fo21Mrdt+1TYZeZ5rzAGx6OPox9AFwWUUsiVQt006Pv+W8EkPGZTaA2lNKZpuhvjOH4Z3EdQj+mG4Ql+EGIYRwzDgL53cM7J3DuHZwfPeEQl7ThJEcUJcqVR1bVEWVUoq1pA3TDcBC9mVhzrvAGydkmaIcsVdGHQNFYOrOMR/YeAaZoiiFLoyqIVldtZaVGvk7lZRJquLsDu+ypDIzUMwhOiOF7ox6iqegbtOrEF9zIzHuRaYKZdhl3XoSgMYgKpEq2b6QwrtR3NVbi1JHczpABxkuB8uUgdh13xCSJr5xYX9FKS69reZFiLorUY+loMDq6557PxAZCqsuj8MSy05jp14oDzJRLjG2M2C3VkVtUStz50DmVZiRDWtlIzAm/GXp7U6suNtnOSBJP5YOw8VzidI6RZLqDtFxQ/pUxbZFku9KiiPPTluT162/f+3QBSFLd7s4/A7sY4AtMIx+ZA+aluEJ7Fj98B2i5fawjAM2UpzYFq8nttDM+ENA+e8f+henuB8V/nBkugFfjZ4H42FL4w/ecn1O8fUH9/4R3dI8uMs8SlNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/af699f146cefa3d11048b59f27330d87/37523/aws-subnet-create-02.png\"\n        srcset=\"/static/af699f146cefa3d11048b59f27330d87/e9ff0/aws-subnet-create-02.png 180w,\n/static/af699f146cefa3d11048b59f27330d87/f21e7/aws-subnet-create-02.png 360w,\n/static/af699f146cefa3d11048b59f27330d87/37523/aws-subnet-create-02.png 720w,\n/static/af699f146cefa3d11048b59f27330d87/98314/aws-subnet-create-02.png 817w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>서브넷을 한개 더 생성해보겠습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7UlEQVQ4y5VU267TMBDMx/PEz/AAEt+AhMQHIIF0TtNLnItv8d0ZtNs0cE5b1FoaOXGc2fHOehttDHa7Fqeuw72xLMvDaGKM2B+OOJ46xJhA7z4EhBX0XGu9+fOt0eSc0QmBXbvHrm3R9QPsPDNm5xi0p5TyBrmUjfSNQtpMx5bawM4e3hMCSq0PHfnyfVOYcsbhcMTLQWCQBtZaVqeNxTw7OOcZ1s4ciH6uS93ScEVICiel0O4PDDGM6ESPUyc4fzGlDRSclBMc5fYWYYwBsu/Rn44Qg0RKCaDjkgLKU12RM2pOG0qKd448W8wvvxCPLeLrb8T9K4pRKFqiaIU8DchyRHEzavCMJQZ4JTngv4RsSgoBVpygxxFT1yFZg+ositUo9EyYDStcSPUKvCubC2lDuXEhIqYMHyLquu+y3fkAbS3n77LODr9zf1NIppCDVDo0tjrLmd01xkCIHqLveSanyWHnPVdEP4z8/pewFAzjxA4rbbZyoJmxLFsAMqyUun2jdVq7UkiEFGmS6lx73t+9Wv+775xD5xxEP3DkZxvBzeZADYBIqSmU9X4+DXb+XK8N3V1SSDk0xj591KtuI7WGVApSnWel9UPghiIlBqmhfn6D/P4J8scXNI8S3CKcpgndqJhs+vwB09eP+AMZun3zAOvRNQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/5d2fa85b16a6f3a08549750984776a08/37523/aws-subnect-create-03.png\"\n        srcset=\"/static/5d2fa85b16a6f3a08549750984776a08/e9ff0/aws-subnect-create-03.png 180w,\n/static/5d2fa85b16a6f3a08549750984776a08/f21e7/aws-subnect-create-03.png 360w,\n/static/5d2fa85b16a6f3a08549750984776a08/37523/aws-subnect-create-03.png 720w,\n/static/5d2fa85b16a6f3a08549750984776a08/27b7a/aws-subnect-create-03.png 804w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>“CIDR 주소가 기존 서브넷과 중첩됩니다” 메시지가 나옵이다. 이는 다른 서브넷에서 해당 대역을 사용하고 있어서 중복이라는 말이므로,<br>\n<code class=\"language-text\">192.240.240.64/26</code> 으로 변경해서 겹치지 않게 설정하여 생성해줍니다.</p>\n<h3 id=\"라우팅-테이블-생성\" style=\"position:relative;\"><a href=\"#%EB%9D%BC%EC%9A%B0%ED%8C%85-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%83%9D%EC%84%B1\" aria-label=\"라우팅 테이블 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>라우팅 테이블 생성</h3>\n<p>라우팅 테이블을 생성 할 때에는 <code class=\"language-text\">VPC</code>를 지정해줍니다.<br>\n생성 후 서브넷은 추가로 설정 해주어야 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+UlEQVQ4y5VU247TMBTsjyPxBXwLgjd+ACEkXtgtKlDabttcmovvSZPUGXRO4irdRssSaeraPh4fnxl7sV6v8fC4xGq1wsPjI5bLH9geYkjrYKyBNv+HxTGKsdsfECUJDlGE3dMe2/0RUZIiZiTc0nwUx4jTFFJpXqy0vsMiy3Jstzv82Wyw2e5gjEVVVXDOwVoLS234P/brup4FZ6iUQpqmiKIIpyxD13Xw3l9xuVxmQXHPYYiQWPO8QF6UqM/na0bOVZxt23Xo+34W9A2/4L6xFouqrmGtw8V7tG3LBISmbRm8O2U0xXiKQHRDGNRxVQ0iJxBRCHoN7jI8ZTnS0wlpOoD6pNhs/bxHXZ9fzpBrRsqOuCr7AqbxbnQF2+Zpv8fhGHGQUoOXtDasGIFcwGXRA3ie+xqS5vQQQ5YaMtQaWZ5DSsXiBK+RF6txd2ppbvCmuzlF8CuNMSEZMqhGdfAB3qNpGpSlYBL6QgzVkUDi3dWQvCeEZHX9JJjGaawUgncnsm4UhkShuaIob8RhQkqb7mpyyvj60IKw66u+3g/2nqpclIIvvOKiG86OTN40LR87mHwKnr/0aHqg8eBWu2ogJGYzeYLmXpEphBSIcwnx7SPE+zeQn95BfHgLufuOxdyCf715FCONhYrXUD8/Q/3+CvXrC1SR4C+kSyBBNwmXlAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/808c7551677ecbb642821727ec6cb733/37523/rt-create.png\"\n        srcset=\"/static/808c7551677ecbb642821727ec6cb733/e9ff0/rt-create.png 180w,\n/static/808c7551677ecbb642821727ec6cb733/f21e7/rt-create.png 360w,\n/static/808c7551677ecbb642821727ec6cb733/37523/rt-create.png 720w,\n/static/808c7551677ecbb642821727ec6cb733/d26aa/rt-create.png 839w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>라우팅 대상</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAc0lEQVQY052OwQ7DIAxD+f8/LTAISMMJPbgCtWhC22WHJyVOHMd573mEyBAjjxDoY2QSYan1L1yWQjMjVKk32GjABMDa+UbKmQ5Q9t5/c57LMIL3+ac2At24ii3p6aUUvlujmk2jVGGuMmu9P3+ltD4f+gVM3jXpdAJHAgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/6b840c3424e020ccac85fd3c07ab85dc/37523/rt-route-list01.png\"\n        srcset=\"/static/6b840c3424e020ccac85fd3c07ab85dc/e9ff0/rt-route-list01.png 180w,\n/static/6b840c3424e020ccac85fd3c07ab85dc/f21e7/rt-route-list01.png 360w,\n/static/6b840c3424e020ccac85fd3c07ab85dc/37523/rt-route-list01.png 720w,\n/static/6b840c3424e020ccac85fd3c07ab85dc/302a4/rt-route-list01.png 1080w,\n/static/6b840c3424e020ccac85fd3c07ab85dc/07a9c/rt-route-list01.png 1440w,\n/static/6b840c3424e020ccac85fd3c07ab85dc/de5f1/rt-route-list01.png 1581w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>서브넷연결하기</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWUlEQVQoz22PSXLiQBBFdf8j+RbesDHINJaEppoyVapBEN+RhdxNE168+L9yrmrUI87dBaNVcN6BvINdbPGiz0iM41KgwEUlPi8E9fkO/f6GqqcItyb4fMPVMDotDRt6ZWF9hPOxKMeMyThc/lzQNg3atkNdf6L5atC1HTjd4G9ApUi2eDjv0VtGZwiGFyhHJf6DYY9hVvg4Hgv1+Yzj6VT8qa6hieEWj8r7BcQEIgIzYdk9MT/0CWaGX9fC4v1/XmZIvjLWYlIK2hhYIhjnYJ0rKrlX9CtmjxuLYZpQTfOMS9NiGAboacCsNGb9QAY7oqKyrPhfcDtKa1RS3F17jNMEsgZE/Pju0/deWXee3zJHaYOK9slrCLjd79i2rZBzRogRefc/bDkjxogQ4t86UemXKyvyAXVzxeFwwGAZmleklBBCQD+M5eJchiTElEpOmuUq8TH9i0vdN5s5r6QUrYCkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/22c2b01096f5b64e5ed5699da1c5c0d2/37523/qwdqd1da.png\"\n        srcset=\"/static/22c2b01096f5b64e5ed5699da1c5c0d2/e9ff0/qwdqd1da.png 180w,\n/static/22c2b01096f5b64e5ed5699da1c5c0d2/f21e7/qwdqd1da.png 360w,\n/static/22c2b01096f5b64e5ed5699da1c5c0d2/37523/qwdqd1da.png 720w,\n/static/22c2b01096f5b64e5ed5699da1c5c0d2/302a4/qwdqd1da.png 1080w,\n/static/22c2b01096f5b64e5ed5699da1c5c0d2/07a9c/qwdqd1da.png 1440w,\n/static/22c2b01096f5b64e5ed5699da1c5c0d2/49ee2/qwdqd1da.png 1618w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">192.240.240.0/24</code> 대역폭 대상으로 활성화 되어 있고,<br>\n해당 VPC 안에 있는 서브넷을 연결 시켜 주 었습니다.</p>\n<p>망 세팅은 여기까지 하고 <code class=\"language-text\">EC2</code>를 생성해서  통신에 대한 <code class=\"language-text\">Ping</code>테스트를 진행해보겠습니다.</p>\n<hr>\n<h3 id=\"ec2-생성하기\" style=\"position:relative;\"><a href=\"#ec2-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"ec2 생성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 생성하기</h3>\n<p><strong>1 OS 선택</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.555555555555557%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAaElEQVQI103MQQrCMBBG4d7/bHoArYpKLVlokpmQLEInTxoRMvCYf/VNz8ed2/mEqBJCwHuPiFBKIefcG3etldYaZtbbNmO/4/XD4fJmcs6xLgspJVSVGGP/IzK2g3+sg/YD51WYX4EvaguZni2ovZQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/30856f92f5d118186af4573693fcc2b1/37523/ec2-create-01.png\"\n        srcset=\"/static/30856f92f5d118186af4573693fcc2b1/e9ff0/ec2-create-01.png 180w,\n/static/30856f92f5d118186af4573693fcc2b1/f21e7/ec2-create-01.png 360w,\n/static/30856f92f5d118186af4573693fcc2b1/37523/ec2-create-01.png 720w,\n/static/30856f92f5d118186af4573693fcc2b1/302a4/ec2-create-01.png 1080w,\n/static/30856f92f5d118186af4573693fcc2b1/07a9c/ec2-create-01.png 1440w,\n/static/30856f92f5d118186af4573693fcc2b1/fe60e/ec2-create-01.png 1677w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>2 VPC 및 서브넷 선택</strong>\n퍼블릭 IP 자동 할당은 <code class=\"language-text\">활성화</code>해주세요.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABX0lEQVQoz1VSi46DIBD0/7+wyV36sr4Q5GUFRJ3LQml7m0zUhczM7lj1fY/r9Yq2bVDXNZpHjfr2i+b2A6M41nWF9/6NdQ0JwXsE7xBCgHMOjs7dE5XWGtM0wRgDxhjatgXnE8QkobSGtTad0XO2FkpbMKHBhMI4aUil07k2BkZLVPiqZVkghMA8z9i2DZ6Unfu4CwGLC7AuwrotwfnwTYFq33cUUAnOQa5jzIT0bo1JxP/reAE4jgPHkTmq/JGxxYiuazFJiRhjIhvH8QUGzjkGxlKfHNOTCwE1B0w2YI17HpnISs2zTRdJrQR2uZxxv98xDEMC9WnfnIsUilkiBuWxhC07TETWQkoJpVTaITk8nzMRBUVEFB7tuIB6RPgZ+8g7pHo+56RKl6RUibBpHgnU67oO48ghZSYlcRKiIKlKDm+HpPSoa5xOJ/TDkFKm0QsZiZXfiCYwr6CKobK1P2KctF5Jyyf/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/4f2a74d717192f491a20ffac10f95373/37523/awc-ec2-create-02.png\"\n        srcset=\"/static/4f2a74d717192f491a20ffac10f95373/e9ff0/awc-ec2-create-02.png 180w,\n/static/4f2a74d717192f491a20ffac10f95373/f21e7/awc-ec2-create-02.png 360w,\n/static/4f2a74d717192f491a20ffac10f95373/37523/awc-ec2-create-02.png 720w,\n/static/4f2a74d717192f491a20ffac10f95373/fd28b/awc-ec2-create-02.png 811w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>3 인스턴스 유형</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAq0lEQVQY012OyRLCIBBE8/8f6MWblRIUAsOSyKZtzcTk4KGru+fBwDTPM1jOe/i4oZSKWitKKeKHWmvn/GD/ubWKSSkFaxcYY6CtA8WM0Tv6T7xojHHmY85L2MfY+3FnCiGAKCDnjOCDiIhEzIyxSCnJo1prxJiE8QcoBGFKaTjn5Py05AGbOmgDLuqG61OBtg+W3OHWAebsNjUot8Ktb+l+2537fcl40EvyF3YJNBij90cYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/7bfec220c43ee19a33dafae487c2c075/37523/ec2-create-02.png\"\n        srcset=\"/static/7bfec220c43ee19a33dafae487c2c075/e9ff0/ec2-create-02.png 180w,\n/static/7bfec220c43ee19a33dafae487c2c075/f21e7/ec2-create-02.png 360w,\n/static/7bfec220c43ee19a33dafae487c2c075/37523/ec2-create-02.png 720w,\n/static/7bfec220c43ee19a33dafae487c2c075/302a4/ec2-create-02.png 1080w,\n/static/7bfec220c43ee19a33dafae487c2c075/07a9c/ec2-create-02.png 1440w,\n/static/7bfec220c43ee19a33dafae487c2c075/71ba4/ec2-create-02.png 1870w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>4 보안그룹은 ssh 접속용 22만 허용</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.444444444444446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAy0lEQVQY062Q2arDMAxE/f//GMjmOBtJbMtL48IUCVxuHu5bBYOEkYbxUVprTGZC3/fYtg0pJcQYpBMFEJEohADvPbwnUAjIOcsOv8cYv1K8ZO0F5xyWZYGZVyzbjnVdxYiX5EgMCRdlpFfB+11QSsF93w8p/CnyHpd1GEcNY4wkqgl5ZuOUInJO+K8kYU1hrcW+72LWNA3atsUwDIKj6zrM8ww9TdLrTVXFosZxxHEc3wSVCX//PM8HHxZzZnnvHsk5CGNSPDCLX9UHvV3O8FlAsTwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/8214a57bb1bd35c0af8be6a295b0955c/37523/ec2-create-04.png\"\n        srcset=\"/static/8214a57bb1bd35c0af8be6a295b0955c/e9ff0/ec2-create-04.png 180w,\n/static/8214a57bb1bd35c0af8be6a295b0955c/f21e7/ec2-create-04.png 360w,\n/static/8214a57bb1bd35c0af8be6a295b0955c/37523/ec2-create-04.png 720w,\n/static/8214a57bb1bd35c0af8be6a295b0955c/302a4/ec2-create-04.png 1080w,\n/static/8214a57bb1bd35c0af8be6a295b0955c/636d3/ec2-create-04.png 1222w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><strong>5 pem key는 최초 한번만 발급되기때문에 보관 잘해야합니다.</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACn0lEQVQ4y3WSWU8TURTH59HlE/jiV4JHMfHFxC8hUYkrRIUiSzc63aYLBSLhQSCgVEAFH0g0Elqw0NJZStrOFGa6yEz7N+e2g42ESX753zNz59xzzv9yE3wErkAUpJO8AHdoGt5wAh6m7TV7F4zCF46Dj8zAJyQuoNgfnb1QzsULmJgKwcmH4fIL8ARj8AZjTG2mwtOYCscZPmGaxd5QnH3jIwkEYnMMltAx7sbwmBsufwROXsCkL8ygtbNz2JgnCKc/Cift6UBduYMxuANtKKaOuMGRCQw5JtmprLpQ/FJLH1Y+YfljEkurSaysrWNxZQ2ryQ2sf93G5y9bSG5uYePbdywsroBzB6JwOH0Y9wYx5gngndvPdNTpw6iLZ1UeZbOQxDxyuSxy2Szyx8eQZRmaqkLTVFQ0DYZ+hp0fP9sJCbui9rz+EYjNQpQklkBRFEiShEKhAKWgQBRFSLKMbO4YmqZhN7UPztNJSEPtdo3wCTMIJ+ZRODlBqVRiPxmGAV3XYRg6jGoNZ9U/qOg1/DFb2Nv/Dc42gWZH7dkt24bQLZALRWQOj1CpVGCaFs5NE2YXlmWBnhQlJCPIYaqSkpLa5pDSNSmWyjjVyrDMc6BpodWNZUJTy2jUa0jtZ8BRJZSQ5mW3akPtC4n3UIoV7Ck15NUGMsUasuU68lqDxXm1jrRYgmrUkT7ItE2xZ9d9XWyDgrE5nOpVlGqAfGqioFsoVptQay2Uqk1UGi2ki+f4ddJE6uAQnDAzDyExD6b/QYZEZhfYyYoiM4cJcl0UJeRFEQVFxtJWGvzyLja3d8ANDI1iYNCBx69G8OQK+p+/wcNnl+nv6NPBYbx8PYJHL96Cu33vAW7dvY+bvX2MGz13LmF/u4rrPX24Rnt7+/AXFD1Z3HstKzAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/94bdf3d377a65afedb711f89b0386d94/37523/ec2-create-05.png\"\n        srcset=\"/static/94bdf3d377a65afedb711f89b0386d94/e9ff0/ec2-create-05.png 180w,\n/static/94bdf3d377a65afedb711f89b0386d94/f21e7/ec2-create-05.png 360w,\n/static/94bdf3d377a65afedb711f89b0386d94/37523/ec2-create-05.png 720w,\n/static/94bdf3d377a65afedb711f89b0386d94/302a4/ec2-create-05.png 1080w,\n/static/94bdf3d377a65afedb711f89b0386d94/c2d9c/ec2-create-05.png 1326w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"ec2-ssh-접속하기\" style=\"position:relative;\"><a href=\"#ec2-ssh-%EC%A0%91%EC%86%8D%ED%95%98%EA%B8%B0\" aria-label=\"ec2 ssh 접속하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EC2 SSH 접속하기</h3>\n<p><code class=\"language-text\">ssh -i \"my-test.pem\" ubuntu@{ ec2 ip }</code> 접속</p>\n<p>혹시 접속이 안된다면,\n<code class=\"language-text\">chmod 400 { name.pem}</code> pem key 권한을 줍니다.<br>\n그래도 안되면,\n<code class=\"language-text\">인바운드 IP</code> 에서 <code class=\"language-text\">22</code>번 포트를 <code class=\"language-text\">0.0.0.0</code>으로 설정하거나 <code class=\"language-text\">내 IP</code>로 해서 집 IP를 지정하셔야합니다.<br>\n왠만하면 보안상 지정 IP 하나만 오픈해놓는게 좋습니다.</p>\n<p>외부랑 통신이 되는지 google 에게 ping 을 보내보겠습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 545px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhUlEQVQI1z2MSw/BQBSFu8WCSh8e3SHBpJ2WaelolURiI8LW//8fn9yRWJ3v3HvO8Z7ZjXdx59O8eKgr4rv5njpMsVHGMUhpJjk21lwSQx1mnOUfpI67xGCGa3RvQd5f4hWDFe1sxynWVL6iHG3ciISlJGwj7Vhy4tvpTw9j5W6Vv/0PfgFuizxa0RmfdQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/3c582a7cad3ed639d3aea424cd8156ff/3ddad/google-ping.png\"\n        srcset=\"/static/3c582a7cad3ed639d3aea424cd8156ff/e9ff0/google-ping.png 180w,\n/static/3c582a7cad3ed639d3aea424cd8156ff/f21e7/google-ping.png 360w,\n/static/3c582a7cad3ed639d3aea424cd8156ff/3ddad/google-ping.png 545w\"\n        sizes=\"(max-width: 545px) 100vw, 545px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>사실 안됩니다. 왜냐하면 위에서 “라우트 테이블” 에서 인터넷 게이트 웨이를 연결 시켜주지 않았기 때문입니다.<br>\n현재로써는 사용하고 있는 서브넷 망 모두 인터넷과 연결이 전혀 안된 상태인것이죠.<br>\n이런 개념으로 별도의 <code class=\"language-text\">internal 라우트 테이블</code> 을 만들어서 “인터넷 게이트 웨이”를 연결 시키지 않고 내부망으로 사용 할 수 있습니다.<br>\n“인터넷 게이트 웨이”가 연결 되어있다 하더라도, “인바운드 IP”를 허용하지 않는다면 외부->내부로 접속이 안되기도 합니다.<br>\n현재는 내부->외부의 통신 테스트 입니다.<br>\n“인터넷 게이트 웨이”를 연결 시켜보겠습니다.</p>\n<h3 id=\"라우트-테이블에-인터넷-게이트-웨이-연결\" style=\"position:relative;\"><a href=\"#%EB%9D%BC%EC%9A%B0%ED%8A%B8-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%97%90-%EC%9D%B8%ED%84%B0%EB%84%B7-%EA%B2%8C%EC%9D%B4%ED%8A%B8-%EC%9B%A8%EC%9D%B4-%EC%97%B0%EA%B2%B0\" aria-label=\"라우트 테이블에 인터넷 게이트 웨이 연결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>라우트 테이블에 인터넷 게이트 웨이 연결</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQY01WPwRLDIAhE/f8f7aTRiBARzWFbaSZpDm9WXGCWsC4vxJQQ04a0ba6ZCIUZLILC4vpPEb7fp0+FfSbMZbUq+hjovT+wU1trjpmd3rN3jAEqBTkTQq3VG4/juDDrj7//wYk29Xp6qnr1Tg1rjB55Fs3MU+1VsRIji0KbuXfT8aYFu+5XMhH5XfRd+AF3NzXehIWhVAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/11ad04301a5b08393becf6f2584e6073/37523/rt-route-list02.png\"\n        srcset=\"/static/11ad04301a5b08393becf6f2584e6073/e9ff0/rt-route-list02.png 180w,\n/static/11ad04301a5b08393becf6f2584e6073/f21e7/rt-route-list02.png 360w,\n/static/11ad04301a5b08393becf6f2584e6073/37523/rt-route-list02.png 720w,\n/static/11ad04301a5b08393becf6f2584e6073/302a4/rt-route-list02.png 1080w,\n/static/11ad04301a5b08393becf6f2584e6073/07a9c/rt-route-list02.png 1440w,\n/static/11ad04301a5b08393becf6f2584e6073/10ab7/rt-route-list02.png 1552w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">0.0.0.0/0</code> 에 대해서 <code class=\"language-text\">igw(인터넷게이트웨이)</code> 를 추가 해주었습니다.<br>\n이제 해당 서브넷을 가지고 있는 <code class=\"language-text\">ec2</code>인스턴스는 외부 인터넷으로 나갈 수 있는 상태입니다(내부 -> 외부 통신)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 492px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1UlEQVQoz01T2XLaQBDUa+y4KmWbI5jDNgaDBOEGgUD3gWQwEPv/f6VTPSsID1O72tnp7pleaad+gn3bxdGI8D1MkTU3yN5sRFUT9uMIbnEC+2EItzSBUxzDLY4RVOZwCmP4v2eScwoj2Vu/+tCORohjL8LffoyPloNdy0HybOGghzgZIdKXtZDwfP/uCfFRD5A0LJx6EbKmLXfOtdpBD+SDRWQhG5UFTwtRwj3VOI8jeOVpfmeMzf1A1PI+Y30/kJx26AbYtV1BJ4hfnkqbcX2FuL6UVgnECJ8WiGomgooCJaHkSlMBZ16j/F3bE0AekIUgcWOFpL6EV5rAL88UYNVEVFteZngNyPkynwOeFaoLZGNhXDNFLQsIzA7CqiLlKLjyXAwrqDHlLXv4eLMVY+4mW6PTBHfzIuZVF9MLoOSKOWBlnrtsRPjs+KLqrCB93SB7Xcu8CEL1HMP22RIygqh5zuFXlFLmtX3HUw6WJvKOZj/eMb/pYHHbVXHTvezNn/r/uNOxvDMkzKtV2zwMRVEmLc8uTtJlzoROM5gjIYuugRe3XBUhQbW0aeNrsMX3cCsPVB50P8bXn0TmmjRWYtqpF8sfxZZ3LVfO+NBJnL5YYibf8z9THFx15hn9TAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/5693acaf3ef45d3d01696b2d4cb52dbf/5c6e9/google-connect-ok.png\"\n        srcset=\"/static/5693acaf3ef45d3d01696b2d4cb52dbf/e9ff0/google-connect-ok.png 180w,\n/static/5693acaf3ef45d3d01696b2d4cb52dbf/f21e7/google-connect-ok.png 360w,\n/static/5693acaf3ef45d3d01696b2d4cb52dbf/5c6e9/google-connect-ok.png 492w\"\n        sizes=\"(max-width: 492px) 100vw, 492px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>내부 -> 외부 인터넷 통신이 되는것을 확인 할 수 있습니다.</p>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>AWS VPC 와 서브넷을 생성해서 망분리를 해보고,<br>\n라우트 테이블에 인터넷 게이트 웨이를 연결 시켜서 외부 통신이 되는지 알아 보았습니다.<br>\n간략한 내용이지만 누군가에게 도움이 되었으면 좋겠네요~</p>","excerpt":"“AWS 망분리” 인프라 담당이 아니라면 깊이 있게 알기 힘들겠지만, 기본적으로 알아야 하는 부분이 있다고 생각합니다. “망분리”에 대해 알아 보겠습니다. 망분리?? 망분리란 내부망과 외부망 등을 분리하여 외부의 침입을 막는거나 보안 이슈를 관리하기 위함입니다. 예를 들면, 중요한 DB 혹은 사내전용 서버 등을 내부망(사내망)으로 분리하여 외부 노출을 분리합니다.\n일반 고객이 접속해야하는 웹서비스 같은 경우 외부망을 오픈하여 외부 인터넷과 접속 할 수 있게 합니다. 개인적인 실무 경험상(일반적인 웹개발자) 심리적으로 굉장히 안정이 됩니다. 인프라 혹은 보안 담당자 없이 AWS 구축하다 보면 무분별하게 생성되는 , 그리고  설정 등 시간이 지날 수록 서버 관리 영역이 관리가 힘들 정도로 난잡해 집니다.\n그때  과 을 분리해 보았는데 관리적인 측면에서 굉장한 이득을 볼 수 있었고, 작은 팀에서 AWS 로 서비스를 운용할때 보안의 불안함이 있는데 이부분에 대해 어느정도 주는 경험했었습니…","frontmatter":{"date":"December 01, 2021","title":"AWS 망분리","categories":"AWS","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/post/2021-12-01-network-separation/"}},"next":{"id":"cb810cca-6de7-5d1e-a9bd-cde3bcffe08b","html":"<br> \n<blockquote>\n<p>학습목적으로 작성되어 생략된 내용과 다소 부적확한 내용이 있을 수 있습니다.</p>\n</blockquote>\n<blockquote>\n<p>다루는 내용<br>\n@Entity, Jpa 연관관계, 편의메소드, @Embedded , @Embeddable</p>\n</blockquote>\n<h1 id=\"예제로-사용해볼-관계도\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%A0%9C%EB%A1%9C-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%BC-%EA%B4%80%EA%B3%84%EB%8F%84\" aria-label=\"예제로 사용해볼 관계도 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예제로 사용해볼 관계도</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 484px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.888888888888886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABG0lEQVQY02WR227CMBBE8/+fVp5ouEQpxSEJNk7sQAAlzcWcyq5ArbrSaPzgPZrdjUR2wFpLURQIIajrGq01VVXhnGOeZ6ZpCno8HkgpKY9HjDFkQpDnOdYYlJQ0TUO03SYBmCQJy+USqVSAp2kaAE+gd18fe0EuNafa8L7Zskl3aGMRxZFPcSCK45jLpQ3NvnzzMI4opf4k7PuerutIdp/shWD0iSH0TfPMV99zrBuixeKNOF5xPl9eiTwoy7IwwvV6pW1b7vd7AKZ7wXq9IjvkDMMQ/nr5t6ws0e12C8k86CmfqCzLF/zpvk61xbmZcRh+VjFNuJCwozjVRH5f/gi/5cf1/u8ozqEqg6wM2jRhd94r21AqjbZnvgFvg8fE0YoTQAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/45d7a8f9fe560a3f64f0cfe9f99d5802/ff42b/jpa-1.png\"\n        srcset=\"/static/45d7a8f9fe560a3f64f0cfe9f99d5802/e9ff0/jpa-1.png 180w,\n/static/45d7a8f9fe560a3f64f0cfe9f99d5802/f21e7/jpa-1.png 360w,\n/static/45d7a8f9fe560a3f64f0cfe9f99d5802/ff42b/jpa-1.png 484w\"\n        sizes=\"(max-width: 484px) 100vw, 484px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p><code class=\"language-text\">User(유저)</code>테이블 과 <code class=\"language-text\">Post(게시물)</code> 테이블이 있습니다.\n이때 <code class=\"language-text\">유저</code>는 여러개 의 <code class=\"language-text\">게시물</code>을 작성 할 수 있습니다.</p>\n<p>위의 테이블 구조로는 <code class=\"language-text\">유저</code>가 작성한 <code class=\"language-text\">게시물</code>이 어떤것 인지 알수 없습니다.<br>\n그래서 이때 relation id 를 둘중 하나의 테이블에 저장 해두어야 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 483px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+klEQVQY001R2W6EQAzj/3+s7fYJtRUSy3IsxzBTyn2I05UjsSKSlZA4jjVYKs+Ra41xHJGkKfI8l7osSxRFgeM4sK6rYN93mflhJPmvKBBGEdq2xTAMSJIEVhiGuN89afq+jyAIRIxDgkEhgkEh27aFk2UZXNeF1ka+HceBlSYxbp83ZEq9XDDzotZaHLI+wd7H+xuecYxpmmS+LIvsicNfYxDHT7lCwhkk0XHXdS+xeZ7F4c/3Fx6+j34YhEtRhlIKFt/MGIO+71FVlaCua+lxRvK2beKANY8+PE+WaYJc7jRNIwas8wdwcAVJXKbYFXwOzumcIqyv+R9iWMgX1Q6oSQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/4f2dbd2baaf4c72ad0fffed50b3723c7/77a9e/jpa-2.png\"\n        srcset=\"/static/4f2dbd2baaf4c72ad0fffed50b3723c7/e9ff0/jpa-2.png 180w,\n/static/4f2dbd2baaf4c72ad0fffed50b3723c7/f21e7/jpa-2.png 360w,\n/static/4f2dbd2baaf4c72ad0fffed50b3723c7/77a9e/jpa-2.png 483w\"\n        sizes=\"(max-width: 483px) 100vw, 483px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>한명의 <code class=\"language-text\">User</code> 가 여러개의 <code class=\"language-text\">Post</code> 를 가질 수 있으므로, <code class=\"language-text\">Post</code> 테이블에 관계 ID를 저장하도록 변경합니다.\n<code class=\"language-text\">Post</code> 테이블에 <code class=\"language-text\">user_id</code> 컬럼은 <code class=\"language-text\">User</code> 테이블의 고유 <code class=\"language-text\">id</code>입니다.</p>\n<h2 id=\"데이터\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0\" aria-label=\"데이터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터</h2>\n<ul>\n<li>User 테이블</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>id</th>\n<th>name</th>\n<th>password</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>name1</td>\n<td>pass1</td>\n</tr>\n<tr>\n<td>2</td>\n<td>name2</td>\n<td>pass2</td>\n</tr>\n<tr>\n<td>3</td>\n<td>name3</td>\n<td>pass3</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>Post 테이블</li>\n</ul>\n<p>|id|user_id|title|contents|\n|------|---|---|\n|1|3|제목 123|내용|\n|1|3|제목 748|내용|\n|2|1|제목 189|내용|\n|3|2|제목 1894|내용|\n|3|2|제목 181|내용|</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">\n<span class=\"token comment\"># user.id 가 \"1\" 인 post 찾기 쿼리  </span>\n<span class=\"token keyword\">select</span> post <span class=\"token keyword\">from</span> post <span class=\"token keyword\">where</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># post 테이블에서 \"post.user_id = 1\" 조건으로 user 데이터 가져오기</span>\n<span class=\"token keyword\">select</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">from</span> post <span class=\"token keyword\">join</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">on</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">=</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">.</span>id <span class=\"token keyword\">where</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># user 테이블에서 \"user.id = 1\" 조건으로 post 데이터 가져오기</span>\n<span class=\"token keyword\">select</span> post <span class=\"token keyword\">from</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">join</span> post <span class=\"token keyword\">on</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>user_id <span class=\"token keyword\">where</span> <span class=\"token keyword\">user</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span> \n</code></pre></div>\n<p>DB 에서는 한쪽 테이블에서 Relation Id(관계 ID)를 가지고 있어도 양방향 조회가 가능합니다.</p>\n<h2 id=\"객체-관점에서-보기\" style=\"position:relative;\"><a href=\"#%EA%B0%9D%EC%B2%B4-%EA%B4%80%EC%A0%90%EC%97%90%EC%84%9C-%EB%B3%B4%EA%B8%B0\" aria-label=\"객체 관점에서 보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>객체 관점에서 보기</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> unique <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Lob</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"contents\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> contents<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> foreignKey <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ForeignKey</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fk_post_user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span> <span class=\"token class-name\">String</span> title<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> contents<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> title<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>contents <span class=\"token operator\">=</span> contents<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>앞서 DB 에서는 어느 한쪽에 연관 ID 를 가지고있으면 양방향으로 조회가되는것을 확인했었습니다.<br>\n하지만 객체입장에서는 양방향이라는 것이 존재하지 않습니다.  단방향만 존재 할 뿐입니다.\n여기서 단방향 관계란, 한쪽의 Entity 에서만 참조 되고있는 것을 말합니다.<br>\n양방향 관계란, 양쪽 Entity 서로 참조 되고 있는 것을 말합니다.</p>\n<p>위의 Entity 코드는 <code class=\"language-text\">User</code> -> <code class=\"language-text\">Post</code> , <code class=\"language-text\">Post</code> -> <code class=\"language-text\">User</code> 어느 Entity 에서든 서로 접근이 가능하기 때문에 양방향 참조 중입니다.</p>\n<p>연관 관계 코드는 아래 두 부분입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token operator\">*</span><span class=\"token operator\">*</span> <span class=\"token class-name\">User</span> entity\n<span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token operator\">*</span><span class=\"token operator\">*</span> <span class=\"token class-name\">Post</span> entity\n<span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span> \n<span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> foreignKey <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ForeignKey</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fk_post_user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n</code></pre></div>\n<ul>\n<li><code class=\"language-text\">mappedBy</code> 옵션은 주인 테이블을 지정해주는 역할합니다. Post entity 에서 설정 되어있는 <code class=\"language-text\">user</code>를 지정합니다.</li>\n<li><code class=\"language-text\">@JoinColumn</code> 으로 연관 관계 컬럼을 지정합니다. 연관 관계 컬럼은 <code class=\"language-text\">user_id</code>으로 설정합니다.</li>\n</ul>\n<p>만약 <code class=\"language-text\">User entity</code> 에서 <code class=\"language-text\">@OneToMany</code>를 제거 한다면, <code class=\"language-text\">Post</code>-><code class=\"language-text\">User</code>의 단방향 관계로만 맵핑됩니다.<br>\n보통은 처음에는 모두 단방향 관계로 설계했다가 프로젝트가 진행하면서 양방향으로 뚫어야 할때 그때 양방향으로 하는것을 지향한다고 합니다.</p>\n<blockquote>\n<p><a href=\"https://www.youtube.com/playlist?list=PL9mhQYIlKEhfpMVndI23RwWTL9-VL-B7U\">토크ON 41차. JPA 프로그래밍 기본기 다지기 T아카데미</a><br>\n영상을 통해 자세한 기본 개념을 익히는데 도움이 됩니다.</p>\n</blockquote>\n<h2 id=\"ddl-문-확인하기\" style=\"position:relative;\"><a href=\"#ddl-%EB%AC%B8-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"ddl 문 확인하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DDL 문 확인하기</h2>\n<p>sql 출력 로그를 확인하기 위해 Spring 프로젝트의 <code class=\"language-text\">application.properties</code> 파일에 아래같이 설정합니다.<br>\nH2 테스트 디비와 , sql 출력 설정입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">spring.datasource.url=jdbc:h2:~/test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE\nspring.datasource.username=sa\nspring.h2.console.enabled=true\n\nspring.jpa.properties.hibernate.format_sql=true\nspring.jpa.show-sql=true\nlogging.level.org.hibernate.type.descriptor.sql=trace</code></pre></div>\n<p>위 코드를 실행하고, DDL 문 출력 결과입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> post <span class=\"token punctuation\">(</span>\n  id <span class=\"token keyword\">bigint</span> generated <span class=\"token keyword\">by</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">identity</span><span class=\"token punctuation\">,</span>\n  contents clob<span class=\"token punctuation\">,</span>\n  title <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  user_id <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">create</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">user</span> <span class=\"token punctuation\">(</span>\n  id <span class=\"token keyword\">bigint</span> generated <span class=\"token keyword\">by</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">identity</span><span class=\"token punctuation\">,</span>\n  name <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  password <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">not</span> <span class=\"token boolean\">null</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">primary</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># 유니크 설정 SQL 입니다.</span>\n<span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> <span class=\"token keyword\">user</span> \n  <span class=\"token keyword\">add</span> <span class=\"token keyword\">constraint</span> UK_gj2fy3dcix7ph7k8684gka40c <span class=\"token keyword\">unique</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># foregin key 설정입니다. </span>\n<span class=\"token comment\"># `@JoinColumn(name = \"user_id\", foreignKey = @ForeignKey(name = \"fk_post_user\"))` 설정 으로 발생하는 쿼리 입니다.</span>\n<span class=\"token keyword\">alter</span> <span class=\"token keyword\">table</span> post \n  <span class=\"token keyword\">add</span> <span class=\"token keyword\">constraint</span> fk_post_user \n  <span class=\"token keyword\">foreign</span> <span class=\"token keyword\">key</span> <span class=\"token punctuation\">(</span>user_id<span class=\"token punctuation\">)</span> \n  <span class=\"token keyword\">references</span> <span class=\"token keyword\">user</span></code></pre></div>\n<blockquote>\n<p>JPA 굳… 어노테이션 맵핑했을 뿐인데 DB 에 해당 부분에 맞추어 만들어줍니다!</p>\n</blockquote>\n<h3 id=\"entity-test-코드로-하나씩-짚어보기\" style=\"position:relative;\"><a href=\"#entity-test-%EC%BD%94%EB%93%9C%EB%A1%9C-%ED%95%98%EB%82%98%EC%94%A9-%EC%A7%9A%EC%96%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"entity test 코드로 하나씩 짚어보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entity Test 코드로 하나씩 짚어보기</h3>\n<h4 id=\"1-양방향-맵핑시-무한루프-문제\" style=\"position:relative;\"><a href=\"#1-%EC%96%91%EB%B0%A9%ED%96%A5-%EB%A7%B5%ED%95%91%EC%8B%9C-%EB%AC%B4%ED%95%9C%EB%A3%A8%ED%94%84-%EB%AC%B8%EC%A0%9C\" aria-label=\"1 양방향 맵핑시 무한루프 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 양방향 맵핑시 무한루프 문제</h4>\n<p>양방향 맵핑시 무한루프가 문제가 발생 할 수 있습니다.<br>\n코드 부터 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">user_to_save_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1. new User</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. new Post</span>\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"제목\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"내용입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      \n    <span class=\"token comment\">// 3. user.addPost()</span>\n    user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 4. post.getUser()</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span><span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 무한 루프 발생 </span>\n<span class=\"token punctuation\">}</span>\n\n\n# 콘솔 로그 \n<span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>StackOverflowError</span>\n\tat <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>jpaexamples<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span>User</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">59</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">2951</span><span class=\"token punctuation\">)</span>\n\tat <span class=\"token class-name\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>jpaexamples<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span>Post</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">57</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">2951</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>StringBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StringBuilder</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">168</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span>AbstractCollection</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AbstractCollection</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">473</span><span class=\"token punctuation\">)</span>\n\tat java<span class=\"token punctuation\">.</span>base<span class=\"token operator\">/</span><span class=\"token class-name\"><span class=\"token namespace\">java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span></span>String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>java<span class=\"token operator\">:</span><span class=\"token number\">2951</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">post.getUser()</code> 를 출력하려는데 <code class=\"language-text\">StackOverflowError</code>에러가 발생합니다.<br>\n이유는 post -> user -> post -> user 계속해서 참조 객체를 찾으려 해서 문제가 발생 한것으로 보여집니다.<br>\n이때에는 <code class=\"language-text\">toString()</code> 메소드를 수정해주어야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n# <span class=\"token class-name\">User</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User{\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", name='\"</span> <span class=\"token operator\">+</span> name <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", password='\"</span> <span class=\"token operator\">+</span> password <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", posts='\"</span> <span class=\"token operator\">+</span> posts <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>  <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">></span> 제거\n            <span class=\"token char\">'}'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n# <span class=\"token constant\">POST</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"Post{\"</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\"id=\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", title='\"</span> <span class=\"token operator\">+</span> title <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", contents='\"</span> <span class=\"token operator\">+</span> contents <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>\n            <span class=\"token string\">\", user='\"</span> <span class=\"token operator\">+</span> user <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>   <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">></span> 제거\n            <span class=\"token char\">'}'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h4 id=\"2-편의메소드\" style=\"position:relative;\"><a href=\"#2-%ED%8E%B8%EC%9D%98%EB%A9%94%EC%86%8C%EB%93%9C\" aria-label=\"2 편의메소드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 편의메소드</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> 편의메소드_예제<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 1. new User</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. new Post</span>\n    <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"제목\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"내용입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. user.getPosts();</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getPosts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span> 결과 <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Post</code> 생성자를 통해 <code class=\"language-text\">user</code>참조 객체를 전달해주었습니다. <code class=\"language-text\">user.getPosts()</code> 출력은 [] 비어 있습니다.<br>\n당연…하지만 편의메소드를 알아보기위한 예제입니다. ㅎ<br>\n보시는것과 같이 객체는 단방향개념 밖에 없습니다. 그래서 객체입장에서는 양방향 관계라기 보다는 양방향 관계인것 처럼 만들어 주어야 합니다.</p>\n<ul>\n<li>편의 메소드 리팩토링</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">toUser</code> 메소드에 <code class=\"language-text\">user.addPost(this);</code> <code class=\"language-text\">user</code> 객체에도 자신(<code class=\"language-text\">post</code>)을 추가해주는 코드를 추가해줍니다. 이제 <code class=\"language-text\">post.toUser(user)</code> 메소드를 호출 하게 되면 <code class=\"language-text\">post</code> 객체에도 추가되고 <code class=\"language-text\">user</code> 객체에도 추가하도록 해주는게 <code class=\"language-text\">편의메소드</code>입니다.</p>\n<p>수정 후 테스트 코드를 다시 실행 해보면 <code class=\"language-text\">user</code> 객체에도 추가된것을 확인 할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">// <span class=\"token number\">3</span>. user.getPosts<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nSystem.out.println<span class=\"token punctuation\">(</span>user.getPosts<span class=\"token punctuation\">(</span><span class=\"token punctuation\">))</span><span class=\"token punctuation\">;</span> // <span class=\"token punctuation\">[</span>Post<span class=\"token punctuation\">{</span>id<span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">title</span><span class=\"token operator\">=</span><span class=\"token string\">'제목'</span>, <span class=\"token assign-left variable\">contents</span><span class=\"token operator\">=</span><span class=\"token string\">'내용입니다.'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h3 id=\"jparepository-test\" style=\"position:relative;\"><a href=\"#jparepository-test\" aria-label=\"jparepository test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JpaRepository Test</h3>\n<p>이제는 JpaRepository 테스트를 통해 데이터를 insert, select 테스트를 해보며 학습해보겠습니다.\n간단하게 짚고만 넘어가겠습니다. <code class=\"language-text\">JpaRepository</code> 는 Entity 클래스를 CRUD 뿐만 <code class=\"language-text\">Query Methods</code>를\n사용하여 DB 쿼리를 만들어주어 추가,업데이트,삭제를 손쉽게 사용 할 수 있는 인터페이스입니다.\n(다음에 자세하게 다루어 보겠습니다..)</p>\n<p><a href=\"https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#preface\">Spring Data JPA 문서</a></p>\n<h4 id=\"entity-레포지토리-만들기\" style=\"position:relative;\"><a href=\"#entity-%EB%A0%88%ED%8F%AC%EC%A7%80%ED%86%A0%EB%A6%AC-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"entity 레포지토리 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Entity 레포지토리 만들기</h4>\n<p>보통은 <code class=\"language-text\">{Entity Name}Repository</code> 의 형태로 이름을 정하고,<br>\n<code class=\"language-text\">public interface {Entity Name}Repository extends JpaRepository&lt;T, ID></code> 의 형태로 레포지토리를 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">#  <span class=\"token class-name\">UserRepository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">UserRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n# <span class=\"token class-name\">PostRepository</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PostRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findByTitle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"jpa-테스트-하기\" style=\"position:relative;\"><a href=\"#jpa-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%98%EA%B8%B0\" aria-label=\"jpa 테스트 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JPA 테스트 하기</h4>\n<p><code class=\"language-text\">@DataJpaTest</code> 를 사용하면 손쉽게 테스트를 진행 할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@DataJpaTest</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RepositoryTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">PostRepository</span> postRepository<span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>User 생성</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">user_save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (1) 비영속</span>\n    userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// (2) 영속</span>\n<span class=\"token punctuation\">}</span>\n\n# 출력 <span class=\"token constant\">SQL</span>\n<span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n        \nbinding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>name1<span class=\"token punctuation\">]</span>\nbinding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PASSWORD</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>(1) 은 비영속 상태로 <code class=\"language-text\">entityManage</code> 에게 매니징 되고 있는 아닌 상태입니다. (2) 에서 <code class=\"language-text\">save(entity)</code> 를 호출하게 되면\nDB에 <code class=\"language-text\">flush</code> 하게 되어 DB insert 가 보내지게 됩니다.<br>\n여기서 말하는 <code class=\"language-text\">영속</code>, <code class=\"language-text\">비영속</code>은 엔티티 생명주기라고 하는데요.<br>\n엔티티 생명주기에는</p>\n<ol>\n<li>비영속(new/transient): 영속성 컨텍스트와 전혀 관계가 없는 상태</li>\n<li>영속(managed): 영속성 컨텍스트에 저장된 상태</li>\n<li>준영속(detached): 영속성 컨텍스트에 저장되었다가 분리된 상태</li>\n<li>삭제(removed): 삭제된 상태</li>\n</ol>\n<p>그럼 영속성 컨텍스트는 뭘까요… ㅜㅜ?<br>\n우선은 업데이트 테스트 부터 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">@Test\nvoid <span class=\"token function-name function\">user_update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    User user <span class=\"token operator\">=</span> new User<span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span>, <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    System.out.println<span class=\"token punctuation\">(</span><span class=\"token string\">\"log (1)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    User savedUser <span class=\"token operator\">=</span> userRepository.save<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    System.out.println<span class=\"token punctuation\">(</span><span class=\"token string\">\"log (2)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    savedUser.setName<span class=\"token punctuation\">(</span><span class=\"token string\">\"이름 변경\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    System.out.println<span class=\"token punctuation\">(</span><span class=\"token string\">\"log (3)\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userRepository.flush<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># log </span>\nlog <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\nHibernate: \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id, name, password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span>null, ?, ?<span class=\"token punctuation\">)</span>\nlog <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\nlog <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\nHibernate: \n    update\n        user \n    <span class=\"token builtin class-name\">set</span>\n        <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span>?,\n        <span class=\"token assign-left variable\">password</span><span class=\"token operator\">=</span>? \n    where\n        <span class=\"token assign-left variable\">id</span><span class=\"token operator\">=</span>?</code></pre></div>\n<p>log 찍힌걸 보면,<br>\n<code class=\"language-text\">User savedUser = userRepository.save(user);</code> 으로 통해 <code class=\"language-text\">insert query</code> 가 commit 됩니다.<br>\n이때 <code class=\"language-text\">savedUser</code> 는 영속성을 가지는 객체입니다.<br>\n<code class=\"language-text\">savedUser.setName(\"이름 변경\")</code> 반응없고,<br>\n<code class=\"language-text\">userRepository.flush()</code> 에서 업데이트 쿼리가 commit 됩니다.<br>\n<code class=\"language-text\">savedUser</code>는 엔티티매니져(영속컨텍스트)에 의해 관리 되고 있는 상태입니다.<br>\n그래서 커밋 시점에 변경된 부분이 있으면 해당 부분을 DB 에 반영시키는 쿼리를 보냅니다.</p>\n<p>더 자세한 설명은…<br>\n<img src=\"../../assets/images/%EC%98%A4%EB%8A%98%EC%9D%80%EC%97%AC%EA%B8%B0%EA%B9%8C%EC%A7%80.png\" alt=\"img.png\"><br>\n자세한 설명은 잘 정리된 블로그 링크로 대체하겠습니다. <a href=\"https://siyoon210.tistory.com/138\">링크</a></p>\n<h5 id=\"post-save\" style=\"position:relative;\"><a href=\"#post-save\" aria-label=\"post save permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Post save</h5>\n<p>Post 를 저장 해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트를 실행하면 <code class=\"language-text\">org.hibernate.TransientPropertyValueException: Not-null property references a transient value ....</code> 에러가 발생합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> foreignKey <span class=\"token operator\">=</span> <span class=\"token annotation punctuation\">@ForeignKey</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fk_post_user\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">@JoinColumn</code> 설정에서 <code class=\"language-text\">nullable = false</code> 옵션을 줬기 때문입니다. 그렇기 때문에 <code class=\"language-text\">Post</code> 저장시 <code class=\"language-text\">User</code> 는 영속(저장된) 상태여야합니다.</p>\n<p>수정된 코드로 실행하면</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// User save</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    \n    # 로그\n    \n<span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>name1<span class=\"token punctuation\">]</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PASSWORD</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">]</span>\n<span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        post\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> contents<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> user_id<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">CLOB</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>content<span class=\"token punctuation\">]</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">VARCHAR</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span>title<span class=\"token punctuation\">]</span>\n <span class=\"token operator\">:</span> binding parameter <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> as <span class=\"token punctuation\">[</span><span class=\"token constant\">BIGINT</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><code class=\"language-text\">user_id</code> 가 [1] 로 들어가지고 있는것을 확인 할 수 있습니다.</p>\n<p><strong>이번에는</strong> <code class=\"language-text\">User</code> 를 통해서 <code class=\"language-text\">Post</code>를 저장해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_user_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// User save</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    # 로그\n    <span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>하지만, <code class=\"language-text\">Post</code>는 저장되지 않습니다. 이유는 연관관계 주인이 아닌곳에서는(<code class=\"language-text\">mappedBy</code>) 읽기만 가능하기 때문입니다.\n이때 두가지 방법이 있습니다.<br>\n<code class=\"language-text\">편의메소드</code>, <code class=\"language-text\">cascade 옵션</code></p>\n<p><strong>1. 편의 메소드</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  # <span class=\"token class-name\">User</span> \n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span> post<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n    \n  # 테스트 코드 \n  user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  postRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">user.addPoat(post)</code> 호출시 내부에서 <code class=\"language-text\">post</code>에게도 양방향으로 적용해주는 방법입니다. 그리고 <code class=\"language-text\">post</code>를 save() 해주어야합니다.</p>\n<p><strong>2. Cascade 옵션</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSIST</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">cascade = CascadeType.PERSIST</code> 옵션을 추가해주는 방법입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save_user_post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PASSWORD!!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// User save</span>\n        <span class=\"token class-name\">Post</span> post <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"content\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    # 로그\n    <span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        user\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n        \n    <span class=\"token class-name\">Hibernate</span><span class=\"token operator\">:</span> \n    insert \n    into\n        post\n        <span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> contents<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> user_id<span class=\"token punctuation\">)</span> \n    values\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">?</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">userRepository.save(user);</code> 할때, <code class=\"language-text\">id</code>가 NULL 이면 같이 저장을 수행합니다.</p>\n<blockquote>\n<ul>\n<li>CascadeType 의 종류</li>\n</ul>\n</blockquote>\n<ul>\n<li>CascadeType.RESIST – 엔티티를 생성하고, 연관 엔티티를 추가하였을 때 persist() 를 수행하면 연관 엔티티도 함께 persist()가 수행된다.</li>\n</ul>\n<p>만약 연관 엔티티가 DB에 등록된 키값을 가지고 있다면 detached entity passed to persist Exception이 발생합니다.</p>\n<ul>\n<li>CascadeType.MERGE – 트랜잭션이 종료되고 detach 상태에서 연관 엔티티를 추가하거나 변경된 이후에 부모 엔티티가 merge()를 수행하게 되면</li>\n</ul>\n<p>변경사항이 적용됨(연관 엔티티의 추가 및 수정 모두 반영됨)</p>\n<ul>\n<li>CascadeType.REMOVE – 삭제 시 연관된 엔티티도 같이 삭제됨</li>\n<li>CascadeType.DETACH – 부모 엔티티가 detach()를 수행하게 되면, 연관된 엔티티도 detach() 상태가 되어 변경사항이 반영되지 않음.</li>\n<li>CascadeType.ALL – 모든 Cascade 적용</li>\n</ul>\n<h4 id=\"embedded--embeddable\" style=\"position:relative;\"><a href=\"#embedded--embeddable\" aria-label=\"embedded  embeddable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>@Embedded , @Embeddable</h4>\n<p>좀더 객체지향적 개발을 위해 데이터를 상태와 행위를 가지는 객체로 추상화 시켜보겠습니다.<br>\n이때에 <code class=\"language-text\">@Embedded , @Embeddable</code>를 활용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Embeddable</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Posts</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PERSIST</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">protected</span> <span class=\"token class-name\">Posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span> post<span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span> writer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        post<span class=\"token punctuation\">.</span><span class=\"token function\">toUser</span><span class=\"token punctuation\">(</span>writer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n      \n    <span class=\"token annotation punctuation\">@Embedded</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Posts</span> posts <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addPost</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Post</span> post<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">List&lt;Post> posts</code> 일급컬렉션으로 <code class=\"language-text\">Posts</code>로 분리하였고 <code class=\"language-text\">@Embeddable</code>어노테이션을 붙였습니다.<br>\n그리고,  사용되는 <code class=\"language-text\">Entity</code> 에서는  <code class=\"language-text\">@Embedded</code> 으로 활용하여 하나의 <code class=\"language-text\">Entity</code>인것 처럼 사용할 수 있습니다.</p>\n<h1 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h1>\n<p>다루어야 될 많은 내용이 아직 많지만, 내용이 너무 길어지는것 같아 여기서 마무리 하겠습니다.\n추후 내용 보완 및 추가해보겠습니다.\n감사합니다.</p>","frontmatter":{"date":"November 21, 2021","title":"JPA - 학습하기","categories":"프로그래밍","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/java/2021-11-21-jpa-1/"}},"prev":{"id":"48fa8d2a-15c6-5880-983a-47ab44271f65","html":"<p>개발 하던중 이벤트 발생 서버와 처리하는 서버가 다를 경우 이벤트 전달에 대해서 고민을 한적이 있습니다.<br>\n그때에, “마이크로서비스 이렇게 한다”책을 보게 되었는데 책에서 <code class=\"language-text\">CDC</code>라는 기술이 있다는것을 알게 되었습니다.</p>\n<p>이후 <code class=\"language-text\">CDC</code>기술에 대해 관심을 가지게 되었고, <code class=\"language-text\">CDC</code>를 활용한다면 서버간의 유연함을 유지하면서 이벤트 기반 아키텍쳐를 구현 할 수 있을것 같았습니다.<br>\n이번 글에서는 Kafka와 CDC 를 위한 분산 플랫폼 Debezium 의 세팅하고 기본 사용하는 부분에 대해서 알아보겠습니다.</p>\n<h1 id=\"카프카란\" style=\"position:relative;\"><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4%EB%9E%80\" aria-label=\"카프카란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>카프카란?</h1>\n<blockquote>\n<p>Kafka는 실시간 이벤트 기반 애플리케이션 개발을 가능하게하는 오픈 소스 분산 스트리밍 플랫폼이다.</p>\n</blockquote>\n<h1 id=\"debezium-이란\" style=\"position:relative;\"><a href=\"#debezium-%EC%9D%B4%EB%9E%80\" aria-label=\"debezium 이란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>debezium 이란?</h1>\n<blockquote>\n<p>Debezium 이란 CDC 를 위한 오픈 소스 분산 플랫폼입니다.<br>\n데이터베이스 커밋으로 발생하는 삽입,업데이트,삭제를 감지하고 인벤트를 발생 시킵니다.<br>\nApache Kafka 를 기반으로 구축 되었습니다.</p>\n</blockquote>\n<h1 id=\"cdc-란\" style=\"position:relative;\"><a href=\"#cdc-%EB%9E%80\" aria-label=\"cdc 란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CDC 란?</h1>\n<blockquote>\n<p>CDC 는 Change Data Capture 의 약자입니다.<br>\n데이터베이스에서 변경 데이터 캡처(change data capture, CDC)는 변경된 데이터를 사용하여 동작을 취할 수 있도록 데이터를 결정하고 추적하기 위해 사용되는 여러 소프트웨어 디자인 패턴들의 모임입니다.</p>\n</blockquote>\n<h1 id=\"시작하기\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0\" aria-label=\"시작하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시작하기</h1>\n<hr>\n<h2 id=\"카프카-실행하기\" style=\"position:relative;\"><a href=\"#%EC%B9%B4%ED%94%84%EC%B9%B4-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0\" aria-label=\"카프카 실행하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>카프카 실행하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">\n<span class=\"token comment\"># 카프카를 다운</span>\n<span class=\"token function\">wget</span> https://www.apache.org/dyn/closer.cgi?path<span class=\"token operator\">=</span>/kafka/3.0.0/kafka_2.13-3.0.0.tgz\n\n<span class=\"token comment\"># 압축 해제</span>\n<span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xzf</span> kafka_2.13-3.0.0.tgz\n\n<span class=\"token comment\"># zookeeper 실행</span>\nbin/zookeeper-server-start.sh config/zookeeper.properties\n\n<span class=\"token comment\"># kafka 실행</span>\nbin/kafka-server-start.sh config/server.properties\n\n<span class=\"token comment\"># topic list 확인</span>\nbin/kafka-topics.sh --bootstrap-server localhost:9092  <span class=\"token parameter variable\">--list</span>\n<span class=\"token operator\">></span> __consumer_offsets</code></pre></div>\n<p>주키퍼와 카프카 실행커멘드까지 살펴보았습니다.</p>\n<p>debezium 을 설치 해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># mysql connect 라이브러리를 다운받습니다</span>\n<span class=\"token comment\"># 이외에도  Postgres, MonggoDB 등등도 가능하므로, 링크 참고(https://debezium.io/documentation/reference/1.8/install.html) </span>\n<span class=\"token function\">wget</span> https://repo1.maven.org/maven2/io/debezium/debezium-connector-mysql/1.8.0.Final/debezium-connector-mysql-1.8.0.Final-plugin.tar.gz\n\n<span class=\"token comment\"># 압축 해제</span>\n<span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xzf</span> debezium-connector-mysql-1.8.0.Final-plugin.tar.gz\n<span class=\"token comment\"># debezium 폴더 파일</span>\nCHANGELOG.md   LICENSE-3rd-PARTIES.txt  README_JA.md            debezium-api-1.8.0.Final.jar              debezium-ddl-parser-1.8.0.Final.jar  mysql-binlog-connector-java-0.25.4.jar\nCONTRIBUTE.md  LICENSE.txt              README_ZH.md            debezium-connector-mysql-1.8.0.Final.jar  failureaccess-1.0.1.jar              mysql-connector-java-8.0.27.jar\nCOPYRIGHT.txt  README.md                antlr4-runtime-4.8.jar  debezium-core-1.8.0.Final.jar             guava-30.0-jre.jar\n---</code></pre></div>\n<p>해당 폴더를 kafka/libs 폴더안으로 이동시켜줍니다.(다른 폴더에 있을때, mysql-connector 를 찾지 못하더라구요)</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 이렇게 이동 시켰습니다.</span>\nkafka_2.13-3.0.0/libs/debezium-connector-mysql</code></pre></div>\n<p>그리고 kafka-connect 설정을 해줘야합니다.<br>\n카프카 프로젝트 안에 <code class=\"language-text\">config/connect-distributed.properties</code> 파일에서</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># config/connect-distributed.properties 파일을 열고 최하단있는 \"plugin.path\" 설정을 수정해야됩니다.</span>\n<span class=\"token comment\"># debezium 라이브러리 위치와 카프카 libs 경로를 지정해줍니다.</span>\n<span class=\"token assign-left variable\">plugin.path</span><span class=\"token operator\">=</span>/home/kafka_2.13-3.0.0/libs, /kafka_2.13-3.0.0/libs/debezium-connector-mysql,</code></pre></div>\n<p>그리고 kafka connect 를 실행하면 되는데요,<br>\n커맨드는 <code class=\"language-text\">bin/connect-distributed.sh config/connect-distributed.properties</code> 입니다.\n해당 커멘드를 치고</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span><span class=\"token number\">2022</span>-01-11 <span class=\"token number\">22</span>:12:05,041<span class=\"token punctuation\">]</span> INFO <span class=\"token punctuation\">[</span>test-db-connectabc<span class=\"token operator\">|</span>task-0<span class=\"token punctuation\">]</span> Connected to MySQL binlog at localhost:3306, starting at MySqlOffsetContext <span class=\"token punctuation\">[</span>sourceInfoSchema<span class=\"token operator\">=</span>Schema<span class=\"token punctuation\">{</span>io.debezium.connector.mysql.Source:STRUCT<span class=\"token punctuation\">}</span>, <span class=\"token assign-left variable\">sourceInfo</span><span class=\"token operator\">=</span>SourceInfo <span class=\"token punctuation\">[</span>currentGtid<span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">currentBinlogFilename</span><span class=\"token operator\">=</span>binlog.000002, <span class=\"token assign-left variable\">currentBinlogPosition</span><span class=\"token operator\">=</span><span class=\"token number\">2655</span>, <span class=\"token assign-left variable\">currentRowNumber</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>, <span class=\"token assign-left variable\">serverId</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>, <span class=\"token assign-left variable\">sourceTime</span><span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">threadId</span><span class=\"token operator\">=</span>-1, <span class=\"token assign-left variable\">currentQuery</span><span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">tableIds</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>, <span class=\"token assign-left variable\">databaseName</span><span class=\"token operator\">=</span>null<span class=\"token punctuation\">]</span>, <span class=\"token assign-left variable\">snapshotCompleted</span><span class=\"token operator\">=</span>false, <span class=\"token assign-left variable\">transactionContext</span><span class=\"token operator\">=</span>TransactionContext <span class=\"token punctuation\">[</span>currentTransactionId<span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">perTableEventCount</span><span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>, <span class=\"token assign-left variable\">totalEventCount</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>, <span class=\"token assign-left variable\">restartGtidSet</span><span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">currentGtidSet</span><span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">restartBinlogFilename</span><span class=\"token operator\">=</span>binlog.000002, <span class=\"token assign-left variable\">restartBinlogPosition</span><span class=\"token operator\">=</span><span class=\"token number\">2655</span>, <span class=\"token assign-left variable\">restartRowsToSkip</span><span class=\"token operator\">=</span><span class=\"token number\">1</span>, <span class=\"token assign-left variable\">restartEventsToSkip</span><span class=\"token operator\">=</span><span class=\"token number\">2</span>, <span class=\"token assign-left variable\">currentEventLengthInBytes</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>, <span class=\"token assign-left variable\">inTransaction</span><span class=\"token operator\">=</span>false, <span class=\"token assign-left variable\">transactionId</span><span class=\"token operator\">=</span>null, incrementalSnapshotContext <span class=\"token operator\">=</span>IncrementalSnapshotContext <span class=\"token punctuation\">[</span>windowOpened<span class=\"token operator\">=</span>false, <span class=\"token assign-left variable\">chunkEndPosition</span><span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">dataCollectionsToSnapshot</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>, <span class=\"token assign-left variable\">lastEventKeySent</span><span class=\"token operator\">=</span>null, <span class=\"token assign-left variable\">maximumKey</span><span class=\"token operator\">=</span>null<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>io.debezium.connector.mysql.MySqlStreamingChangeEventSource:1203<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">2022</span>-01-11 <span class=\"token number\">22</span>:12:05,042<span class=\"token punctuation\">]</span> INFO <span class=\"token punctuation\">[</span>test-db-connectabc<span class=\"token operator\">|</span>task-0<span class=\"token punctuation\">]</span> Waiting <span class=\"token keyword\">for</span> keepalive thread to start <span class=\"token punctuation\">(</span>io.debezium.connector.mysql.MySqlStreamingChangeEventSource:935<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">2022</span>-01-11 <span class=\"token number\">22</span>:12:05,043<span class=\"token punctuation\">]</span> INFO <span class=\"token punctuation\">[</span>test-db-connectabc<span class=\"token operator\">|</span>task-0<span class=\"token punctuation\">]</span> Creating thread debezium-mysqlconnector-serverName-binlog-client <span class=\"token punctuation\">(</span>io.debezium.util.Threads:287<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span><span class=\"token number\">2022</span>-01-11 <span class=\"token number\">22</span>:12:05,145<span class=\"token punctuation\">]</span> INFO <span class=\"token punctuation\">[</span>test-db-connectabc<span class=\"token operator\">|</span>task-0<span class=\"token punctuation\">]</span> Keepalive thread is running <span class=\"token punctuation\">(</span>io.debezium.connector.mysql.MySqlStreamingChangeEventSource:942<span class=\"token punctuation\">)</span>\n이렇게 되면 연결 성공입니다.</code></pre></div>\n<p>debezium 은 rest api 를 지원하는데요,<br>\n잘 실행 됬는지 호출해봅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Accept:application/json\"</span> localhost:8083/\n<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"version\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"3.0.0\"</span>,<span class=\"token string\">\"commit\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"8cb0a5e9d3441962\"</span>,<span class=\"token string\">\"kafka_cluster_id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"XwZqiJE3QhytA2hnnleoJw\"</span><span class=\"token punctuation\">}</span>\n\n대충 이렇게 나오면 정상 실행중입니다.</code></pre></div>\n<p>저는 mysql connector 를 사용 할것이므로,\n로컬 mysql 서봐 커넥터를 생성 해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-i</span> <span class=\"token parameter variable\">-X</span> POST <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Accept:application/json\"</span> <span class=\"token parameter variable\">-H</span> <span class=\"token string\">\"Content-Type:application/json\"</span> localhost:8083/connectors <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'{\n  \"name\": \"test-db-connect-test\",  &lt;--- 커넥션 이름\n  \"config\": {  \n    \"connector.class\": \"io.debezium.connector.mysql.MySqlConnector\", &lt;--- 컨넥션 라이브러리 \n    \"tasks.max\": \"1\",  \n    \"database.hostname\": \"localhost\",   &lt;--- DB 접속 주소\n    \"database.port\": \"3306\",            &lt;--- DB 접속 포트 \n    \"database.user\": \"debezium\",        &lt;--- DB 접속 아이디\n    \"database.password\": \"password\",    &lt;--- DB 접속 패스워드\n    \"database.server.id\": \"1\",  \n    \"database.server.name\": \"serverName-test\", \n    \"table.include.list\": \"debezium_db.users\", &lt;--- 감시하고자 하는 테이블, 포맷은 {데이터베이스 이름}.{테이블이름} 입니다 \n    \"database.history.kafka.bootstrap.servers\": \"localhost:9092\",  &lt;--- 카프카 주소( 클러스터 구성시 콤마로 붙여주면 됩니다.)\n    \"database.history.kafka.topic\": \"schema-changes.users\"   \n  }\n}'</span>\n\n<span class=\"token operator\">></span> HTTP/1.1 <span class=\"token number\">201</span> Created\n<span class=\"token operator\">></span> Date: Tue, <span class=\"token number\">11</span> Jan <span class=\"token number\">2022</span> <span class=\"token number\">13</span>:17:36 GMT\n<span class=\"token operator\">></span> Location: http://localhost:8083/connectors/test-db-connect-test\n<span class=\"token operator\">></span> Content-Type: application/json\n<span class=\"token operator\">></span> Content-Length: <span class=\"token number\">512</span>\n<span class=\"token operator\">></span> Server: Jetty<span class=\"token punctuation\">(</span><span class=\"token number\">9.4</span>.43.v20210629<span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">></span>  <span class=\"token punctuation\">{</span><span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"test-db-connect-test\"</span>,<span class=\"token string\">\"config\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"connector.class\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"io.debezium.connector.mysql.MySqlConnector\"</span>,<span class=\"token string\">\"tasks.max\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span>,<span class=\"token string\">\"database.hostname\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"localhost\"</span>,<span class=\"token string\">\"database.port\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"3306\"</span>,<span class=\"token string\">\"database.user\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"debezium\"</span>,<span class=\"token string\">\"database.password\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"password\"</span>,<span class=\"token string\">\"database.server.id\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1\"</span>,<span class=\"token string\">\"database.server.name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"serverName-test\"</span>,<span class=\"token string\">\"table.include.list\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"debezium_db.users\"</span>,<span class=\"token string\">\"database.history.kafka.bootstrap.servers\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"localhost:9092\"</span>,<span class=\"token string\">\"database.history.kafka.topic\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"schema-changes.users\"</span>,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"test-db-connect-test\"</span><span class=\"token punctuation\">}</span>,<span class=\"token string\">\"tasks\"</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>,<span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"source\"</span><span class=\"token punctuation\">}</span>\n\n정상 생성 되었습니다.  </code></pre></div>\n<p>이제 부터 users 테이블에서 변경이 발견하면 topic에 저장 되게됩니다.<br>\n그렇다면 어떠한 토픽이 생성되었는지 확인해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> bin/kafka-topics.sh --bootstrap-server localhost:9092  <span class=\"token parameter variable\">--list</span>\n\n__consumer_offsets\nconnect-configs\nconnect-offsets\nconnect-status\nschema-changes.users\nserverName-test\nserverName-test.debezium_db.users\n\n<span class=\"token string\">\"serverName-test.debezium_db.users\"</span> 해당 토픽이 생성된 토픽입니다.   </code></pre></div>\n<p>컨슈밍 하면서 DB 변경을 잘 추적하는지 확인해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 컨슈머를 실행 합니다. </span>\nbin/kafka-console-consumer.sh <span class=\"token parameter variable\">--topic</span> serverName-test.debezium_db.users --from-beginning --bootstrap-server localhost:9092\n\n<span class=\"token comment\"># 업데이트 쿼리를 날려보겠습니다. </span>\nUPDATE debezium_db.users t SET t.age <span class=\"token operator\">=</span> <span class=\"token number\">30</span> WHERE t.id <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token comment\"># 컨슈머로 이벤트 데이터가 들어오는것을 확인할 수 있습니다. </span>\n<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"schema\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"struct\"</span>,<span class=\"token string\">\"fields\"</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"struct\"</span>,<span class=\"token string\">\"fields\"</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int32\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int32\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"age\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"serverName_test.debezium_db.users.Value\"</span>,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"before\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"struct\"</span>,<span class=\"token string\">\"fields\"</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int32\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int32\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"age\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"serverName_test.debezium_db.users.Value\"</span>,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"after\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"struct\"</span>,<span class=\"token string\">\"fields\"</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"version\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"connector\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int64\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"ts_ms\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"io.debezium.data.Enum\"</span>,<span class=\"token string\">\"version\"</span>:1,<span class=\"token string\">\"parameters\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"allowed\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"true,last,false,incremental\"</span><span class=\"token punctuation\">}</span>,<span class=\"token string\">\"default\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"false\"</span>,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"snapshot\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"db\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"sequence\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"table\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int64\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"server_id\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"gtid\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"file\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int64\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"pos\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int32\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"row\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int64\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"thread\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"query\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"io.debezium.connector.mysql.Source\"</span>,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"source\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"op\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int64\"</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"ts_ms\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"struct\"</span>,<span class=\"token string\">\"fields\"</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"string\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int64\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"total_order\"</span><span class=\"token punctuation\">}</span>,<span class=\"token punctuation\">{</span><span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"int64\"</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"data_collection_order\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>,<span class=\"token string\">\"optional\"</span>:true,<span class=\"token string\">\"field\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"transaction\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>,<span class=\"token string\">\"optional\"</span>:false,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"serverName_test.debezium_db.users.Envelope\"</span><span class=\"token punctuation\">}</span>,<span class=\"token string\">\"payload\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"before\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"id\"</span>:1,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"홍길동\"</span>,<span class=\"token string\">\"age\"</span>:31<span class=\"token punctuation\">}</span>,<span class=\"token string\">\"after\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"id\"</span>:1,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"홍길동\"</span>,<span class=\"token string\">\"age\"</span>:30<span class=\"token punctuation\">}</span>,<span class=\"token string\">\"source\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"version\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"1.8.0.Final\"</span>,<span class=\"token string\">\"connector\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"mysql\"</span>,<span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"serverName-test\"</span>,<span class=\"token string\">\"ts_ms\"</span>:1641907335000,<span class=\"token string\">\"snapshot\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"false\"</span>,<span class=\"token string\">\"db\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"debezium_db\"</span>,<span class=\"token string\">\"sequence\"</span>:null,<span class=\"token string\">\"table\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"users\"</span>,<span class=\"token string\">\"server_id\"</span>:1,<span class=\"token string\">\"gtid\"</span>:null,<span class=\"token string\">\"file\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"binlog.000002\"</span>,<span class=\"token string\">\"pos\"</span>:3153,<span class=\"token string\">\"row\"</span>:0,<span class=\"token string\">\"thread\"</span>:null,<span class=\"token string\">\"query\"</span>:null<span class=\"token punctuation\">}</span>,<span class=\"token string\">\"op\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"u\"</span>,<span class=\"token string\">\"ts_ms\"</span>:1641907335852,<span class=\"token string\">\"transaction\"</span>:null<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n변경된 데이터는 JSON 데이터에서 \n<span class=\"token variable\"><span class=\"token variable\">`</span>\"payload<span class=\"token string\">\":{\"</span>before<span class=\"token string\">\":{\"</span><span class=\"token function\">id</span><span class=\"token string\">\":1,\"</span>name<span class=\"token string\">\":\"</span>홍길동<span class=\"token string\">\",\"</span>age<span class=\"token string\">\":31},\"</span>after<span class=\"token string\">\":{\"</span><span class=\"token function\">id</span><span class=\"token string\">\":1,\"</span>name<span class=\"token string\">\":\"</span>홍길동<span class=\"token string\">\",\"</span>age\":30<span class=\"token punctuation\">}</span><span class=\"token variable\">`</span></span>\n<span class=\"token string\">\"payload\"</span> key의 값으로 들어옵니다 </code></pre></div>\n<p>만약에 컬럼이 더블 타입일 경우 숫자가 들어올때 이상한 숫자로 들어 올수 있는데요,<br>\n<code class=\"language-text\">\"decimal.handling.mode\": \"double\"</code> 해당 옵션을 커넥트 생성시 넣어주면 더블숫자 그대로 잘 들어 옵니다.</p>\n<p>이외에도 공식문서에 다양한 옵션이 정말 많습니다. <a href=\"https://debezium.io/documentation/reference/1.7/connectors/mysql.html#mysql-property-decimal-handling-mode\">공식 문서 참고</a></p>\n<hr>\n<h1 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h1>\n<p><a href=\"https://debezium.io/documentation/reference/tutorial.html\">디베지움 공식</a><br>\n<a href=\"https://kafka.apache.org/\">카프카 공식</a><br>\n<a href=\"https://www.sosconhistory.net/soscon2019/content/data/session/Day%202_1730_2.pdf\">Debezium 쓸까? 말까?</a><br>\n<a href=\"https://www.qlik.com/us/change-data-capture/cdc-change-data-capture\">cdc-change-data-capture</a></p>","frontmatter":{"date":"January 11, 2022","title":"kafka 와 debezium 살펴보기","categories":"kafka","author":"wooobo","emoji":"🔮"},"fields":{"slug":"/kafka/2022-01-11-kafka-debezium-cdc/"}},"site":{"siteMetadata":{"siteUrl":"https://wooobo.github.io","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/post/2021-12-01-network-separation/","nextSlug":"/java/2021-11-21-jpa-1/","prevSlug":"/kafka/2022-01-11-kafka-debezium-cdc/"}},"staticQueryHashes":["1073350324","1956554647","2938748437"]}